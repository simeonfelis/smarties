<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Smarties2: smarties2.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
<h1>smarties2.c</h1><a href="smarties2_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00175"></a>00175 <span class="preprocessor">#include &lt;avr/interrupt.h&gt;</span>
<a name="l00176"></a>00176 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>     <span class="comment">// math stuff, itoa etc.</span>
<a name="l00177"></a>00177 <span class="preprocessor">#include "<a class="code" href="smarties2_8h.html" title="Include file for smarties2 project.">smarties2.h</a>"</span>
<a name="l00178"></a>00178 <span class="preprocessor">#include "<a class="code" href="system_8h.html" title="Smarites machine API header file.">system.h</a>"</span>
<a name="l00179"></a>00179 <span class="preprocessor">#include "inits.h"</span>
<a name="l00180"></a>00180 <span class="preprocessor">#include "<a class="code" href="menu_8h.html" title="The menu structure and handling.">menu.h</a>"</span>
<a name="l00181"></a>00181 <span class="preprocessor">#include "<a class="code" href="ee_8h.html" title="Some EEProm memory administration.">ee.h</a>"</span>             <span class="comment">// EEprom memory administration</span>
<a name="l00182"></a>00182 <span class="preprocessor">#include "<a class="code" href="lcd__display_8h.html" title="Basic routines for interfacing a HD44780U-based text LCD display.">lcd_display.h</a>"</span>    <span class="comment">//display lib</span>
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="preprocessor">#define DEBUG   1           // verbose output mode</span>
<a name="l00185"></a>00185 <span class="preprocessor"></span>
<a name="l00186"></a>00186 <a class="code" href="structsmartie__sorter__t.html" title="All devices from the smartie sorter collected to one bundle.">smartie_sorter</a> ss;
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 <a class="code" href="structmenu__entry__t.html" title="The menu structure.">menu_entry</a> *menu_current;                       <span class="comment">// currently displayed menu</span>
<a name="l00189"></a>00189 <a class="code" href="structmenu__entry__t.html" title="The menu structure.">menu_entry</a> men_initializing;                    <span class="comment">// shown during SYS_MODE_INIT</span>
<a name="l00190"></a>00190 <a class="code" href="structmenu__entry__t.html" title="The menu structure.">menu_entry</a> men_running;                         <span class="comment">// shown during SYS_MODE_RUNNING</span>
<a name="l00191"></a>00191 <a class="code" href="structmenu__entry__t.html" title="The menu structure.">menu_entry</a> men_lay_greeting[2];                 <span class="comment">// entry menu</span>
<a name="l00192"></a>00192 <a class="code" href="structmenu__entry__t.html" title="The menu structure.">menu_entry</a> men_lay_main[MEN_LAY_MAIN_SIZE];     <span class="comment">// general menu for different tasks </span>
<a name="l00193"></a>00193 <a class="code" href="structmenu__entry__t.html" title="The menu structure.">menu_entry</a> men_lay_speed;                       <span class="comment">// setting up the system speed</span>
<a name="l00194"></a>00194 <a class="code" href="structmenu__entry__t.html" title="The menu structure.">menu_entry</a> men_lay_reference [MEN_LAY_REFERENCE_SIZE]; <span class="comment">// for calibrating the reference values</span>
<a name="l00195"></a>00195 
<a name="l00196"></a>00196 <span class="preprocessor">#if DISTANCE_DETECTION | DISTANCE_NORM_DETECTION</span>
<a name="l00197"></a>00197 <span class="preprocessor"></span>
<a name="l00198"></a>00198 <span class="keyword">extern</span> <a class="code" href="system_8h.html#b51ee7141ec54f3e8185d9487af887d5" title="Stores the color reference values of one channel for all smarties.">color_avarage</a> col_ava_blu;
<a name="l00199"></a>00199 <span class="keyword">extern</span> <a class="code" href="system_8h.html#b51ee7141ec54f3e8185d9487af887d5" title="Stores the color reference values of one channel for all smarties.">color_avarage</a> col_ava_gre;
<a name="l00200"></a>00200 <span class="keyword">extern</span> <a class="code" href="system_8h.html#b51ee7141ec54f3e8185d9487af887d5" title="Stores the color reference values of one channel for all smarties.">color_avarage</a> col_ava_red;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 <span class="preprocessor">#endif</span>
<a name="l00203"></a>00203 <span class="preprocessor"></span>
<a name="l00204"></a>00204 <span class="comment">// Function documentation always at the place of definition, not decleration </span>
<a name="l00205"></a>00205 <span class="keywordtype">void</span> <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a> (smartie_color color);
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 
<a name="l00221"></a><a class="code" href="smarties2_8c.html#840291bc02cba5474a4cb46a9b9566fe">00221</a> <span class="keywordtype">int</span> <a class="code" href="smarties2_8c.html#840291bc02cba5474a4cb46a9b9566fe" title="Entry functin for smarties2.">main</a>(<span class="keywordtype">void</span>) {
<a name="l00222"></a>00222     uint8_t temp = 1; <span class="comment">// during init loop and other small loops</span>
<a name="l00223"></a>00223     uint8_t sm_count; <span class="comment">// for color reference measure </span>
<a name="l00224"></a>00224     <span class="keywordtype">float</span> sm_ref_measure_blu; <span class="comment">// for color reference measure</span>
<a name="l00225"></a>00225     <span class="keywordtype">float</span> sm_ref_measure_gre; <span class="comment">// for color reference measure</span>
<a name="l00226"></a>00226     <span class="keywordtype">float</span> sm_ref_measure_red; <span class="comment">// for color reference measure</span>
<a name="l00227"></a>00227     
<a name="l00228"></a>00228     int8_t index_temp;              <span class="comment">// for geting the correct color the catcher has to move to</span>
<a name="l00229"></a>00229     smartie_color col_temp = 0;     <span class="comment">// for some small loops </span>
<a name="l00230"></a>00230 
<a name="l00231"></a>00231     <span class="keywordtype">char</span> s[7];                      <span class="comment">// a dummy, needed for itoa()</span>
<a name="l00232"></a>00232     
<a name="l00233"></a>00233     ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#903c7b848a8b43a1b50e2fbb54a7cb7d" title="Stores the current mode.">mode</a> = <a class="code" href="system_8h.html#6e4cea4b6246f491c526211f5405627d6f86e68a36933ceea048d78b95769945" title="After reset or power on.">SYS_MODE_INIT</a>;
<a name="l00234"></a>00234     ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#d5b7e91c9a338f631520d1bad5912c8e" title="Stores the last mode for transition steps.">mode_last</a> = <a class="code" href="system_8h.html#6e4cea4b6246f491c526211f5405627d6f86e68a36933ceea048d78b95769945" title="After reset or power on.">SYS_MODE_INIT</a>;
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     <a class="code" href="inits_8c.html#c2a3b2c7f1e4975e9080f9f4df57fb84" title="Calls all necessary init functions.">init_all</a>();
<a name="l00237"></a>00237     sei ();
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     <span class="comment">/* Wait for some init functions to be finished */</span>
<a name="l00240"></a>00240     <span class="keywordflow">while</span> (temp) {
<a name="l00241"></a>00241         <span class="comment">/* catcher motor status output */</span>
<a name="l00242"></a>00242         <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(12,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"c"</span>);
<a name="l00243"></a>00243         <span class="keywordflow">switch</span> (ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#71c0bbc3adc7f7f200e6853fd361c12d" title="Status.">status</a>) {
<a name="l00244"></a>00244         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>:
<a name="l00245"></a>00245             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(13,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"cidl"</span>);
<a name="l00246"></a>00246             <span class="keywordflow">break</span>;
<a name="l00247"></a>00247         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b0338a176a30f108279905bb42b5f80ad22" title="Setting a module&amp;#39;s state to this will start the device to work.">stat_start_working</a>:
<a name="l00248"></a>00248             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(13,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"csta"</span>);
<a name="l00249"></a>00249             <span class="keywordflow">break</span>;
<a name="l00250"></a>00250         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b03b1cdb8bf66313ecce10a4b1c240ea569" title="Indicates the device is busy. The device will automatically change to this state...">stat_working</a>:
<a name="l00251"></a>00251             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(13,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"cwor"</span>);
<a name="l00252"></a>00252             <span class="keywordflow">break</span>;
<a name="l00253"></a>00253         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b038200fdccabe0d9e135d68523c729b1c5" title="Setting a device to this state will stop the device.">stat_stop_working</a>:
<a name="l00254"></a>00254             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(13,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"csto"</span>);
<a name="l00255"></a>00255             <span class="keywordflow">break</span>;
<a name="l00256"></a>00256         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b036c9c8c7b8f55418d3c0981b2412f9324" title="Indicates the device is finished. The device will automatically change to this state...">stat_finished</a>:
<a name="l00257"></a>00257             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(13,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"cfin"</span>);
<a name="l00258"></a>00258             <span class="keywordflow">break</span>;
<a name="l00259"></a>00259         <span class="keywordflow">default</span>:
<a name="l00260"></a>00260             <span class="keywordflow">break</span>;
<a name="l00261"></a>00261         }
<a name="l00262"></a>00262         <span class="keywordflow">switch</span> (ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a>) {
<a name="l00263"></a>00263         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>:
<a name="l00264"></a>00264             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(19,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"lidl"</span>);
<a name="l00265"></a>00265             <span class="keywordflow">break</span>;
<a name="l00266"></a>00266         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b0338a176a30f108279905bb42b5f80ad22" title="Setting a module&amp;#39;s state to this will start the device to work.">stat_start_working</a>:
<a name="l00267"></a>00267             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(19,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"lsta"</span>);
<a name="l00268"></a>00268             <span class="keywordflow">break</span>;
<a name="l00269"></a>00269         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b03b1cdb8bf66313ecce10a4b1c240ea569" title="Indicates the device is busy. The device will automatically change to this state...">stat_working</a>:
<a name="l00270"></a>00270             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(19,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"lwor"</span>);
<a name="l00271"></a>00271             <span class="keywordflow">break</span>;
<a name="l00272"></a>00272         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b038200fdccabe0d9e135d68523c729b1c5" title="Setting a device to this state will stop the device.">stat_stop_working</a>:
<a name="l00273"></a>00273             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(19,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"lsto"</span>);
<a name="l00274"></a>00274             <span class="keywordflow">break</span>;
<a name="l00275"></a>00275         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b036c9c8c7b8f55418d3c0981b2412f9324" title="Indicates the device is finished. The device will automatically change to this state...">stat_finished</a>:
<a name="l00276"></a>00276             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(19,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"lfin"</span>);
<a name="l00277"></a>00277             <span class="keywordflow">break</span>;                  
<a name="l00278"></a>00278         <span class="keywordflow">default</span>:
<a name="l00279"></a>00279             <span class="keywordflow">break</span>;
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281         <span class="comment">/* revolver motor status output */</span>
<a name="l00282"></a>00282         <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"r"</span>);
<a name="l00283"></a>00283         <span class="keywordflow">switch</span> (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#71c0bbc3adc7f7f200e6853fd361c12d" title="Status.">status</a>) {
<a name="l00284"></a>00284         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>:
<a name="l00285"></a>00285             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(1,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"cidl"</span>);
<a name="l00286"></a>00286             <span class="keywordflow">break</span>;
<a name="l00287"></a>00287         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b0338a176a30f108279905bb42b5f80ad22" title="Setting a module&amp;#39;s state to this will start the device to work.">stat_start_working</a>:
<a name="l00288"></a>00288             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(1,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"csta"</span>);
<a name="l00289"></a>00289             <span class="keywordflow">break</span>;
<a name="l00290"></a>00290         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b03b1cdb8bf66313ecce10a4b1c240ea569" title="Indicates the device is busy. The device will automatically change to this state...">stat_working</a>:
<a name="l00291"></a>00291             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(1,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"cwor"</span>);
<a name="l00292"></a>00292             <span class="keywordflow">break</span>;
<a name="l00293"></a>00293         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b038200fdccabe0d9e135d68523c729b1c5" title="Setting a device to this state will stop the device.">stat_stop_working</a>:
<a name="l00294"></a>00294             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(1,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"csto"</span>);
<a name="l00295"></a>00295             <span class="keywordflow">break</span>;
<a name="l00296"></a>00296         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b036c9c8c7b8f55418d3c0981b2412f9324" title="Indicates the device is finished. The device will automatically change to this state...">stat_finished</a>:
<a name="l00297"></a>00297             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(1,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"cfin"</span>);
<a name="l00298"></a>00298             <span class="keywordflow">break</span>;
<a name="l00299"></a>00299         <span class="keywordflow">default</span>:
<a name="l00300"></a>00300             <span class="keywordflow">break</span>;
<a name="l00301"></a>00301         }
<a name="l00302"></a>00302         <span class="keywordflow">switch</span> (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a>) {
<a name="l00303"></a>00303         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>:
<a name="l00304"></a>00304             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(7,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"lidl"</span>);
<a name="l00305"></a>00305             <span class="keywordflow">break</span>;
<a name="l00306"></a>00306         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b0338a176a30f108279905bb42b5f80ad22" title="Setting a module&amp;#39;s state to this will start the device to work.">stat_start_working</a>:
<a name="l00307"></a>00307             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(7,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"lsta"</span>);
<a name="l00308"></a>00308             <span class="keywordflow">break</span>;
<a name="l00309"></a>00309         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b03b1cdb8bf66313ecce10a4b1c240ea569" title="Indicates the device is busy. The device will automatically change to this state...">stat_working</a>:
<a name="l00310"></a>00310             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(7,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"lwor"</span>);
<a name="l00311"></a>00311             <span class="keywordflow">break</span>;
<a name="l00312"></a>00312         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b038200fdccabe0d9e135d68523c729b1c5" title="Setting a device to this state will stop the device.">stat_stop_working</a>:
<a name="l00313"></a>00313             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(7,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"lsto"</span>);
<a name="l00314"></a>00314             <span class="keywordflow">break</span>;
<a name="l00315"></a>00315         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b036c9c8c7b8f55418d3c0981b2412f9324" title="Indicates the device is finished. The device will automatically change to this state...">stat_finished</a>:
<a name="l00316"></a>00316             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(7,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"lfin"</span>);
<a name="l00317"></a>00317             <span class="keywordflow">break</span>;                  
<a name="l00318"></a>00318         <span class="keywordflow">default</span>:
<a name="l00319"></a>00319             <span class="keywordflow">break</span>;
<a name="l00320"></a>00320         }
<a name="l00321"></a>00321         
<a name="l00322"></a>00322         <span class="keywordflow">if</span> ( (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#71c0bbc3adc7f7f200e6853fd361c12d" title="Status.">status</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>)
<a name="l00323"></a>00323                 &amp;&amp; (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> != <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) ) <span class="comment">/* Wait until position is found */</span>
<a name="l00324"></a>00324             ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>;
<a name="l00325"></a>00325 
<a name="l00326"></a>00326         <span class="keywordflow">if</span> ( (ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#71c0bbc3adc7f7f200e6853fd361c12d" title="Status.">status</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>)
<a name="l00327"></a>00327                 &amp;&amp; (ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> != <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) ) <span class="comment">/* Wait until position is found */</span>
<a name="l00328"></a>00328             ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>;
<a name="l00329"></a>00329 
<a name="l00330"></a>00330         <span class="keywordflow">if</span> ( (ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) 
<a name="l00331"></a>00331                 &amp;&amp; (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) ) {
<a name="l00332"></a>00332             ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a> = 0;
<a name="l00333"></a>00333             ss.<a class="code" href="structsmartie__sorter__t.html#7a25892a550431decfc6ff9a2a722307" title="Lightbarrier for the revolver.">lb_revolver</a>.<a class="code" href="structlightbarrier__t.html#1440294184c4cfe99bd441730874cb2e" title="The amount of recognized passes through the lightbarrier.">passes</a> = 0;
<a name="l00334"></a>00334 
<a name="l00335"></a>00335             temp = 0;
<a name="l00336"></a>00336         }
<a name="l00337"></a>00337     }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339     <span class="comment">/* initializing done, set state */</span>
<a name="l00340"></a>00340     ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#d5b7e91c9a338f631520d1bad5912c8e" title="Stores the last mode for transition steps.">mode_last</a> = ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#903c7b848a8b43a1b50e2fbb54a7cb7d" title="Stores the current mode.">mode</a>;
<a name="l00341"></a>00341     ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#903c7b848a8b43a1b50e2fbb54a7cb7d" title="Stores the current mode.">mode</a> = <a class="code" href="system_8h.html#6e4cea4b6246f491c526211f5405627df1c8a041b6d3d46002d02ed0645a8ba2" title="Pausing the smartie sorter and operated manually.">SYS_MODE_PAUSE</a>;
<a name="l00342"></a>00342 
<a name="l00343"></a>00343     <a class="code" href="lcd__display_8c.html#f8da853dba4b9d5f2aea4e294444e14d" title="Clear display and set cursor to home position.">lcd_clrscr</a>();
<a name="l00344"></a>00344         
<a name="l00345"></a>00345     <span class="keywordflow">while</span> (1) <span class="comment">/* Main loop */</span>
<a name="l00346"></a>00346     {
<a name="l00347"></a>00347         <span class="keywordflow">switch</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#903c7b848a8b43a1b50e2fbb54a7cb7d" title="Stores the current mode.">mode</a>) {
<a name="l00348"></a>00348         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6e4cea4b6246f491c526211f5405627d6f86e68a36933ceea048d78b95769945" title="After reset or power on.">SYS_MODE_INIT</a>:
<a name="l00349"></a>00349             <span class="keywordflow">break</span>;
<a name="l00350"></a>00350         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6e4cea4b6246f491c526211f5405627df1c8a041b6d3d46002d02ed0645a8ba2" title="Pausing the smartie sorter and operated manually.">SYS_MODE_PAUSE</a>:
<a name="l00351"></a>00351             <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#d5b7e91c9a338f631520d1bad5912c8e" title="Stores the last mode for transition steps.">mode_last</a> != <a class="code" href="system_8h.html#6e4cea4b6246f491c526211f5405627df1c8a041b6d3d46002d02ed0645a8ba2" title="Pausing the smartie sorter and operated manually.">SYS_MODE_PAUSE</a>) { <span class="comment">/* if we just entered that mode */</span>
<a name="l00352"></a>00352                 menu_current = &amp;men_lay_greeting[0];
<a name="l00353"></a>00353                 <span class="comment">/* if we come from a reset */</span>
<a name="l00354"></a>00354                 <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#d5b7e91c9a338f631520d1bad5912c8e" title="Stores the last mode for transition steps.">mode_last</a> == <a class="code" href="system_8h.html#6e4cea4b6246f491c526211f5405627d6f86e68a36933ceea048d78b95769945" title="After reset or power on.">SYS_MODE_INIT</a>)
<a name="l00355"></a>00355                     menu_current = &amp;men_lay_greeting[1];                    
<a name="l00356"></a>00356                 <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,0); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(menu_current-&gt;<a class="code" href="structmenu__entry__t.html#775b6ff7a7787b730066cba76532a32d" title="Text on Display (Max 24 Characters, 2 lines).">text</a>[0]);
<a name="l00357"></a>00357                 <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(menu_current-&gt;<a class="code" href="structmenu__entry__t.html#775b6ff7a7787b730066cba76532a32d" title="Text on Display (Max 24 Characters, 2 lines).">text</a>[1]);
<a name="l00358"></a>00358 <span class="comment">/* test lcd write */</span>                
<a name="l00359"></a>00359 <span class="comment">//              lcd_gotoxy(0,0); lcd_puts(itoa(sizeof(color_avarage),s,10));</span>
<a name="l00360"></a>00360                 ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#d5b7e91c9a338f631520d1bad5912c8e" title="Stores the last mode for transition steps.">mode_last</a> = <a class="code" href="system_8h.html#6e4cea4b6246f491c526211f5405627df1c8a041b6d3d46002d02ed0645a8ba2" title="Pausing the smartie sorter and operated manually.">SYS_MODE_PAUSE</a>;
<a name="l00361"></a>00361                 ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#a7f30fead1929b6ef4c7923fff04ec46" title="The status before current status.">status_last</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>;
<a name="l00362"></a>00362             }
<a name="l00363"></a>00363             
<a name="l00364"></a>00364             <span class="comment">/* color measure program tcs */</span>
<a name="l00365"></a>00365             <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> == <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc5527897518563ff6607106d839ed48fd8e" title="Indicates that the color measure program is runnging.">prog_color_tcs</a>) {
<a name="l00366"></a>00366                 <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#a7f30fead1929b6ef4c7923fff04ec46" title="The status before current status.">status_last</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b036c9c8c7b8f55418d3c0981b2412f9324" title="Indicates the device is finished. The device will automatically change to this state...">stat_finished</a>) {
<a name="l00367"></a>00367                     ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#a7f30fead1929b6ef4c7923fff04ec46" title="The status before current status.">status_last</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>;
<a name="l00368"></a>00368                     <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(8,0); <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a>(ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#645722a2409effbe46339525eba50542" title="The value from the last color detection.">color</a>);
<a name="l00369"></a>00369                     <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(15,0); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"dis:  "</span>);
<a name="l00370"></a>00370                     <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(19,0); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#5711e6b7dd97725d47387d57767f76f3" title="Needed for the distance to an reference value.">distance</a>,s,10));
<a name="l00371"></a>00371                     <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(MEN_TIT_EMPTY);
<a name="l00372"></a>00372                     <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"Blu:"</span>);
<a name="l00373"></a>00373                     <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#932f2edbd620800cb115897b50537616" title="The clock frequency in kHz measured with blue filter on.">filter_freq_blue</a>&lt;10) <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>);
<a name="l00374"></a>00374                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#932f2edbd620800cb115897b50537616" title="The clock frequency in kHz measured with blue filter on.">filter_freq_blue</a>, s, 10));
<a name="l00375"></a>00375                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"Gre:"</span>);
<a name="l00376"></a>00376                     <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#492b9a4317c14731f6a79d1b44372bcf" title="The clock frequency in kHz measured with green filter on.">filter_freq_green</a>&lt;10) <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>);
<a name="l00377"></a>00377                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#492b9a4317c14731f6a79d1b44372bcf" title="The clock frequency in kHz measured with green filter on.">filter_freq_green</a>, s, 10));
<a name="l00378"></a>00378                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"Red:"</span>);
<a name="l00379"></a>00379                     <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#a82029dfdc10172be6206df50c80eb08" title="The clock frequency in kHz measured with red filter on.">filter_freq_red</a>&lt;10) <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>);
<a name="l00380"></a>00380                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#a82029dfdc10172be6206df50c80eb08" title="The clock frequency in kHz measured with red filter on.">filter_freq_red</a>, s, 10));
<a name="l00381"></a>00381                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"Bri:"</span>);
<a name="l00382"></a>00382                     <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#1960e5bd9f79595e67082119b3aaa15a" title="The clock frequency in kHz measured with no filter on. Could be interpreted as general...">filter_freq_none</a>&lt;10) <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>);
<a name="l00383"></a>00383                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#1960e5bd9f79595e67082119b3aaa15a" title="The clock frequency in kHz measured with no filter on. Could be interpreted as general...">filter_freq_none</a>, s, 10));
<a name="l00384"></a>00384                 }
<a name="l00385"></a>00385             }
<a name="l00386"></a>00386             
<a name="l00387"></a>00387             <span class="comment">/* rotate program revolver */</span>
<a name="l00388"></a>00388             <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> == <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc55cf735b3ab9ceededb902db503e7271b9" title="Indicates that the revolver rotate program is running.">prog_rotate_revolver</a>) {
<a name="l00389"></a>00389                 <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(9,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"Pos:"</span>);
<a name="l00390"></a>00390                 <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>&lt;10) <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>);
<a name="l00391"></a>00391                 <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>, s, 10));             
<a name="l00392"></a>00392                 <span class="keywordflow">if</span> ( (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#71c0bbc3adc7f7f200e6853fd361c12d" title="Status.">status</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) &amp;&amp; (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> != <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a> ) ) {
<a name="l00393"></a>00393                     ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>;
<a name="l00394"></a>00394                 }
<a name="l00395"></a>00395             }
<a name="l00396"></a>00396             
<a name="l00397"></a>00397             <span class="comment">/* rotate program catcher */</span>
<a name="l00398"></a>00398             <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> == <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc55331eb332ffb09740f70737359d79fff7" title="Indicates that the catcher rotate program is running.">prog_rotate_catcher</a>) {
<a name="l00399"></a>00399                 <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"Now:"</span>);
<a name="l00400"></a>00400                 <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a>(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>); 
<a name="l00401"></a>00401                 <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>, s, 10)); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">";"</span>);
<a name="l00402"></a>00402                 <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"Next:"</span>); 
<a name="l00403"></a>00403                 <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a>(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#a21f2e88216c74bd38d655b596b927c2" title="Target position (smartie_color_t can also be used).">target_pos</a>);
<a name="l00404"></a>00404                 <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#a21f2e88216c74bd38d655b596b927c2" title="Target position (smartie_color_t can also be used).">target_pos</a>,s,10)); 
<a name="l00405"></a>00405                 <span class="keywordflow">if</span> ( (ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#71c0bbc3adc7f7f200e6853fd361c12d" title="Status.">status</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) &amp;&amp; (ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> != <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) ) {
<a name="l00406"></a>00406                     ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>;
<a name="l00407"></a>00407                 }
<a name="l00408"></a>00408             }
<a name="l00409"></a>00409             <span class="comment">/* Speed setting program */</span>
<a name="l00410"></a>00410             <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> == prog_set_speed) {
<a name="l00411"></a>00411                 <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(7,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"Now:"</span>);
<a name="l00412"></a>00412                 <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#dd43953759e4028e7eae83127ce6c98b" title="The operating speed (pause durations) the higher, the slower. See also sys_set_speed()...">speed</a>,s,10));
<a name="l00413"></a>00413                 <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#dd43953759e4028e7eae83127ce6c98b" title="The operating speed (pause durations) the higher, the slower. See also sys_set_speed()...">speed</a> &lt; 10)
<a name="l00414"></a>00414                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"   "</span>);
<a name="l00415"></a>00415                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#dd43953759e4028e7eae83127ce6c98b" title="The operating speed (pause durations) the higher, the slower. See also sys_set_speed()...">speed</a> &lt; 100)
<a name="l00416"></a>00416                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"  "</span>);
<a name="l00417"></a>00417                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#dd43953759e4028e7eae83127ce6c98b" title="The operating speed (pause durations) the higher, the slower. See also sys_set_speed()...">speed</a> &lt; 1000)
<a name="l00418"></a>00418                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"   "</span>);
<a name="l00419"></a>00419             }
<a name="l00420"></a>00420             
<a name="l00421"></a>00421             <span class="comment">/* Color setting program (holds state machine)*/</span>
<a name="l00422"></a>00422             <span class="keywordflow">if</span> ( (ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> &gt;= <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc55e7156e0e78e0f3ce9f2ce0d7bbe8bac5" title="Calibrates the color refence values. Halts the state machine.">prog_set_colors_blue</a>) &amp;&amp; (ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a>&lt;=<a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc5501a7745145aaf9b3fe840b3cb1a6b84f" title="Calibrates the color refence values. Halts the state machine.">prog_set_colors_pink</a>) ){
<a name="l00423"></a>00423                 sm_ref_measure_blu = 0; sm_ref_measure_gre = 0; sm_ref_measure_red = 0;
<a name="l00424"></a>00424                 <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(MEN_TIT_EMPTY);
<a name="l00425"></a>00425                 <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"   left;                "</span>);
<a name="l00426"></a>00426                 <span class="keywordflow">for</span> (sm_count=0; sm_count&lt;<a class="code" href="smarties2_8h.html#9096c984562438499379bbaa027512e0" title="How many measures for a callibrating the reference value are required.">REFERENCE_MEASURES</a>; sm_count++) { <span class="comment">/* capture a few smarties values for each channel */</span>
<a name="l00427"></a>00427                     <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa((REFERENCE_MEASURES-sm_count),s,10)); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>); <span class="comment">/* progress to user, also neede for timing! */</span> 
<a name="l00428"></a>00428                     <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#20530712b28b29eef3109313b9907bd2" title="The rotary encoder (user input).">rotenc</a>.<a class="code" href="structrotary__encoder__t.html#4c3ef6e33c8b1a62cc0fd62885692e46" title="The amount of detected pushes.">push</a> &gt; 0)
<a name="l00429"></a>00429                         <span class="keywordflow">break</span>;
<a name="l00430"></a>00430                     <a class="code" href="system_8c.html#4312b8582a99de2443c53adce9359dc5" title="Rotates the revolver from the current position to a relative next position regarding...">revolver_rotate_relative</a>(1);
<a name="l00431"></a>00431                     temp = 1;
<a name="l00432"></a>00432                     <span class="keywordflow">while</span> (temp) { <span class="comment">/* wait for revolver */</span>
<a name="l00433"></a>00433                         <span class="keywordflow">if</span> ( (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#71c0bbc3adc7f7f200e6853fd361c12d" title="Status.">status</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) &amp;&amp; (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> != <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) ) { 
<a name="l00434"></a>00434                             ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>;
<a name="l00435"></a>00435                             temp = 0;
<a name="l00436"></a>00436                         }
<a name="l00437"></a>00437                         <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa((10-sm_count),s,10)); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>); <span class="comment">/* progress to user, also neede for timing! */</span>
<a name="l00438"></a>00438                     }
<a name="l00439"></a>00439                     <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa((10-sm_count),s,10)); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>); <span class="comment">/* progress to user, also neede for timing! */</span>
<a name="l00440"></a>00440                     <a class="code" href="system_8c.html#895d4e598ce146273eb5dc50e5a140ea" title="Initiates the color detection by the TCS color sensor.">sensor_tcs_get_color</a>();
<a name="l00441"></a>00441                     temp = 1;
<a name="l00442"></a>00442                     <span class="keywordflow">while</span> (temp) {  <span class="comment">/* wait for color sensor */</span>
<a name="l00443"></a>00443                         <span class="keywordflow">if</span> ( (ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#6cf7d985b536f4551302359ddb90c802" title="The current status of the color sensor.">status</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) &amp;&amp; (ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#a7f30fead1929b6ef4c7923fff04ec46" title="The status before current status.">status_last</a> != <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) ) { 
<a name="l00444"></a>00444                             ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#a7f30fead1929b6ef4c7923fff04ec46" title="The status before current status.">status_last</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>;
<a name="l00445"></a>00445                             temp = 0;
<a name="l00446"></a>00446                         }
<a name="l00447"></a>00447                         <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa((10-sm_count),s,10)); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>); <span class="comment">/* progress to user, also neede for timing! */</span>
<a name="l00448"></a>00448                     }
<a name="l00449"></a>00449                     <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa((10-sm_count),s,10)); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>); <span class="comment">/* progress to user, also neede for timing! */</span>
<a name="l00450"></a>00450                     <span class="comment">/* add all channel values up */</span>
<a name="l00451"></a>00451                     sm_ref_measure_blu += ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#932f2edbd620800cb115897b50537616" title="The clock frequency in kHz measured with blue filter on.">filter_freq_blue</a>;
<a name="l00452"></a>00452                     sm_ref_measure_gre += ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#492b9a4317c14731f6a79d1b44372bcf" title="The clock frequency in kHz measured with green filter on.">filter_freq_green</a>;
<a name="l00453"></a>00453                     sm_ref_measure_red += ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#a82029dfdc10172be6206df50c80eb08" title="The clock frequency in kHz measured with red filter on.">filter_freq_red</a>;
<a name="l00454"></a>00454                 }
<a name="l00455"></a>00455 <span class="comment">//              if (ss.rotenc.push == 0) { /* check if canceled */</span>
<a name="l00456"></a>00456                     <span class="keywordflow">switch</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a>) { <span class="comment">/* depending on which color to callibrate, get to correctin index for storing */</span>
<a name="l00457"></a>00457                     <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc55e7156e0e78e0f3ce9f2ce0d7bbe8bac5" title="Calibrates the color refence values. Halts the state machine.">prog_set_colors_blue</a>:
<a name="l00458"></a>00458                         col_temp = <a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b2b5a96dd4664a6aeab46c81b3f7e357be" title="Blue.">col_blue</a>;
<a name="l00459"></a>00459                         <span class="keywordflow">break</span>;
<a name="l00460"></a>00460                     <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc55d6ae9a7c1b1f295ef5d5b24ce2b82ee9" title="Calibrates the color refence values. Halts the state machine.">prog_set_colors_green</a>:
<a name="l00461"></a>00461                         col_temp = <a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b26a0e2721ce49eab7403f47519fc0ef64" title="Green.">col_green</a>;
<a name="l00462"></a>00462                         <span class="keywordflow">break</span>;
<a name="l00463"></a>00463                     <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc5520d6445008330db524343a7f811b3e5b" title="Calibrates the color refence values. Halts the state machine.">prog_set_colors_red</a>:
<a name="l00464"></a>00464                         col_temp = <a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b2f3023a6d67057a1b646478eb80619db2" title="Red.">col_red</a>;
<a name="l00465"></a>00465                         <span class="keywordflow">break</span>;
<a name="l00466"></a>00466                     <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc55cacbcee890d85b9ebe3b797cc57516f3" title="Calibrates the color refence values. Halts the state machine.">prog_set_colors_yellow</a>:
<a name="l00467"></a>00467                         col_temp = <a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b2b41b78747aaed535dfae65498e06ad26" title="Yellow.">col_yellow</a>;
<a name="l00468"></a>00468                         <span class="keywordflow">break</span>;
<a name="l00469"></a>00469                     <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc553e3770483237eb4ea1076e81dc517d30" title="Calibrates the color refence values. Halts the state machine.">prog_set_colors_orange</a>:
<a name="l00470"></a>00470                         col_temp = <a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b25cdf68f9bbce4f120d93db95e584146c" title="Orange.">col_orange</a>;
<a name="l00471"></a>00471                         <span class="keywordflow">break</span>;
<a name="l00472"></a>00472                     <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc559e40df4de71d78cd961b87202f71645c" title="Calibrates the color refence values. Halts the state machine.">prog_set_colors_brown</a>:
<a name="l00473"></a>00473                         col_temp = <a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b256708c6b715321f832ce4ca7426a3b31" title="Brown.">col_brown</a>;
<a name="l00474"></a>00474                         <span class="keywordflow">break</span>;
<a name="l00475"></a>00475                     <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc553a7a5a24627fdea73087ba56c941b3ab" title="Calibrates the color refence values. Halts the state machine.">prog_set_colors_purple</a>:
<a name="l00476"></a>00476                         col_temp = <a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b229840715f465dff615d65002c94f5cfc" title="Purple.">col_purple</a>;
<a name="l00477"></a>00477                         <span class="keywordflow">break</span>;
<a name="l00478"></a>00478                     <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc5501a7745145aaf9b3fe840b3cb1a6b84f" title="Calibrates the color refence values. Halts the state machine.">prog_set_colors_pink</a>:
<a name="l00479"></a>00479                         col_temp = <a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b278bb2430f9b464e19f321964a6e75aa2" title="Pink.">col_pink</a>;
<a name="l00480"></a>00480                         <span class="keywordflow">break</span>;
<a name="l00481"></a>00481                     <span class="keywordflow">default</span>:
<a name="l00482"></a>00482                         <span class="keywordflow">break</span>;
<a name="l00483"></a>00483                     }
<a name="l00484"></a>00484                     <span class="comment">/* calculate the avarage value for each channel out of the few values */</span>
<a name="l00485"></a>00485                     col_ava_blu[col_temp] = sm_ref_measure_blu / REFERENCE_MEASURES;
<a name="l00486"></a>00486                     col_ava_gre[col_temp] = sm_ref_measure_gre / REFERENCE_MEASURES;
<a name="l00487"></a>00487                     col_ava_red[col_temp] = sm_ref_measure_red / REFERENCE_MEASURES;
<a name="l00488"></a>00488                     <span class="comment">/* write it back to eeprom as user defined reference value */</span>
<a name="l00489"></a>00489                     eeprom_write_block (&amp;ee_mem.<a class="code" href="structee__memory__t.html#13bee4728a634caf8d0ec18f18972b32" title="User calibrated color reference values for all smarites, blue channel.">usr_blu</a>[col_temp], &amp;col_ava_blu[col_temp], <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00490"></a>00490                     eeprom_write_block (&amp;ee_mem.<a class="code" href="structee__memory__t.html#d2b73f4590d08a5e556829996a2d4225" title="User calibrated color reference values for all smarites, green channel.">usr_gre</a>[col_temp], &amp;col_ava_gre[col_temp], <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00491"></a>00491                     eeprom_write_block (&amp;ee_mem.<a class="code" href="structee__memory__t.html#f9514a77d59e960a549843c5c90d60b7" title="User calibrated color reference values for all smarites, red channel.">usr_red</a>[col_temp], &amp;col_ava_red[col_temp], <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00492"></a>00492                     <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,0); <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a>(col_temp); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" callibrated.     "</span>);
<a name="l00493"></a>00493 
<a name="l00494"></a>00494 <span class="comment">//              }</span>
<a name="l00495"></a>00495 <span class="comment">//              else {</span>
<a name="l00496"></a>00496 <span class="comment">//                  lcd_gotoxy(0,0); lcd_puts("Callibration canceled   ");</span>
<a name="l00497"></a>00497 <span class="comment">//              }</span>
<a name="l00498"></a>00498                 <span class="comment">/* inform user about what happend. This is done by changing the normal menu behaviour */</span>
<a name="l00499"></a>00499                 ss.<a class="code" href="structsmartie__sorter__t.html#20530712b28b29eef3109313b9907bd2" title="The rotary encoder (user input).">rotenc</a>.<a class="code" href="structrotary__encoder__t.html#4c3ef6e33c8b1a62cc0fd62885692e46" title="The amount of detected pushes.">push</a> = 0;
<a name="l00500"></a>00500                 <span class="keywordflow">while</span> (ss.<a class="code" href="structsmartie__sorter__t.html#20530712b28b29eef3109313b9907bd2" title="The rotary encoder (user input).">rotenc</a>.<a class="code" href="structrotary__encoder__t.html#4c3ef6e33c8b1a62cc0fd62885692e46" title="The amount of detected pushes.">push</a> == 0) {
<a name="l00501"></a>00501                     <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"Press to continue.      "</span>); 
<a name="l00502"></a>00502                 }
<a name="l00503"></a>00503                 ss.<a class="code" href="structsmartie__sorter__t.html#20530712b28b29eef3109313b9907bd2" title="The rotary encoder (user input).">rotenc</a>.<a class="code" href="structrotary__encoder__t.html#4c3ef6e33c8b1a62cc0fd62885692e46" title="The amount of detected pushes.">push</a> = 0;
<a name="l00504"></a>00504                 ss.<a class="code" href="structsmartie__sorter__t.html#20530712b28b29eef3109313b9907bd2" title="The rotary encoder (user input).">rotenc</a>.<a class="code" href="structrotary__encoder__t.html#264955f38189fb291a5698e99acf55df" title="The amount of detected left turns.">left</a> = 1;
<a name="l00505"></a>00505                 <span class="comment">/* all done */</span>
<a name="l00506"></a>00506                 ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> = <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc556ab1bff0b64b5014a737f2598e75a2ef" title="No program executed.">prog_none</a>;
<a name="l00507"></a>00507             } <span class="comment">/* prog_set_colors_(*) */</span>
<a name="l00508"></a>00508             
<a name="l00509"></a>00509             <span class="comment">/* Program for restoring the system default values */</span>
<a name="l00510"></a>00510             <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> == <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc5532962d0000a87aa56300fc78330ac987" title="Resores the color refernce values to system defaults. Halts the state machine.">prog_set_colors_restore</a>) {
<a name="l00511"></a>00511 <span class="preprocessor">#if DISTANCE_DETECTION | DISTANCE_NORM_DETECTION</span>
<a name="l00512"></a>00512 <span class="preprocessor"></span>                <span class="comment">/* Get the system default values */</span>
<a name="l00513"></a>00513                 eeprom_read_block (col_ava_blu, ee_mem.<a class="code" href="structee__memory__t.html#415eb4641ad491d014fc717ba6255734" title="System default color reference values for all smarties, blue channel.">def_blu</a>, <span class="keyword">sizeof</span>(<a class="code" href="system_8h.html#b51ee7141ec54f3e8185d9487af887d5" title="Stores the color reference values of one channel for all smarties.">color_avarage</a>));
<a name="l00514"></a>00514                 eeprom_read_block (col_ava_gre, ee_mem.<a class="code" href="structee__memory__t.html#7159cb0e6d0a5cec77ea5a315fc95da3" title="System default color reference values for all smarties, green channel.">def_gre</a>, <span class="keyword">sizeof</span>(<a class="code" href="system_8h.html#b51ee7141ec54f3e8185d9487af887d5" title="Stores the color reference values of one channel for all smarties.">color_avarage</a>));
<a name="l00515"></a>00515                 eeprom_read_block (col_ava_red, ee_mem.<a class="code" href="structee__memory__t.html#a7f0e34983d98e32877b654927bbf53b" title="System default color reference values for all smarties, bred channel.">def_red</a>, <span class="keyword">sizeof</span>(<a class="code" href="system_8h.html#b51ee7141ec54f3e8185d9487af887d5" title="Stores the color reference values of one channel for all smarties.">color_avarage</a>));
<a name="l00516"></a>00516                 
<a name="l00517"></a>00517                 <span class="comment">/* Use the in future */</span>
<a name="l00518"></a>00518                 eeprom_write_block (ee_mem.<a class="code" href="structee__memory__t.html#13bee4728a634caf8d0ec18f18972b32" title="User calibrated color reference values for all smarites, blue channel.">usr_blu</a>, col_ava_blu, <span class="keyword">sizeof</span>(<a class="code" href="system_8h.html#b51ee7141ec54f3e8185d9487af887d5" title="Stores the color reference values of one channel for all smarties.">color_avarage</a>));
<a name="l00519"></a>00519                 eeprom_write_block (ee_mem.<a class="code" href="structee__memory__t.html#d2b73f4590d08a5e556829996a2d4225" title="User calibrated color reference values for all smarites, green channel.">usr_gre</a>, col_ava_gre, <span class="keyword">sizeof</span>(<a class="code" href="system_8h.html#b51ee7141ec54f3e8185d9487af887d5" title="Stores the color reference values of one channel for all smarties.">color_avarage</a>));
<a name="l00520"></a>00520                 eeprom_write_block (ee_mem.<a class="code" href="structee__memory__t.html#f9514a77d59e960a549843c5c90d60b7" title="User calibrated color reference values for all smarites, red channel.">usr_red</a>, col_ava_red, <span class="keyword">sizeof</span>(<a class="code" href="system_8h.html#b51ee7141ec54f3e8185d9487af887d5" title="Stores the color reference values of one channel for all smarties.">color_avarage</a>));
<a name="l00521"></a>00521 <span class="preprocessor">#endif</span>
<a name="l00522"></a>00522 <span class="preprocessor"></span>                <span class="comment">/* inform user about what happend. This is done by changing the normal menu behaviour */</span>
<a name="l00523"></a>00523                 ss.<a class="code" href="structsmartie__sorter__t.html#20530712b28b29eef3109313b9907bd2" title="The rotary encoder (user input).">rotenc</a>.<a class="code" href="structrotary__encoder__t.html#4c3ef6e33c8b1a62cc0fd62885692e46" title="The amount of detected pushes.">push</a> = 0;
<a name="l00524"></a>00524                 <span class="keywordflow">while</span> (ss.<a class="code" href="structsmartie__sorter__t.html#20530712b28b29eef3109313b9907bd2" title="The rotary encoder (user input).">rotenc</a>.<a class="code" href="structrotary__encoder__t.html#4c3ef6e33c8b1a62cc0fd62885692e46" title="The amount of detected pushes.">push</a> == 0) {
<a name="l00525"></a>00525                     <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"Done. Press to continue."</span>); 
<a name="l00526"></a>00526                 }
<a name="l00527"></a>00527                 ss.<a class="code" href="structsmartie__sorter__t.html#20530712b28b29eef3109313b9907bd2" title="The rotary encoder (user input).">rotenc</a>.<a class="code" href="structrotary__encoder__t.html#4c3ef6e33c8b1a62cc0fd62885692e46" title="The amount of detected pushes.">push</a> = 0;
<a name="l00528"></a>00528                 ss.<a class="code" href="structsmartie__sorter__t.html#20530712b28b29eef3109313b9907bd2" title="The rotary encoder (user input).">rotenc</a>.<a class="code" href="structrotary__encoder__t.html#bf888e3b4cc08d5ced47c59224d6aa57" title="The amount of detected right turns.">right</a> = 1;
<a name="l00529"></a>00529                 ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> = <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc556ab1bff0b64b5014a737f2598e75a2ef" title="No program executed.">prog_none</a>;
<a name="l00530"></a>00530             }
<a name="l00531"></a>00531             
<a name="l00532"></a>00532             <span class="keywordflow">break</span>; <span class="comment">/* SYS_MODE_PAUSE */</span>
<a name="l00533"></a>00533 
<a name="l00534"></a>00534 <span class="comment">/******************************* SYS_MODE_RUNNING *******************************************/</span>
<a name="l00535"></a>00535 
<a name="l00536"></a>00536         <span class="keywordflow">case</span> <a class="code" href="system_8h.html#6e4cea4b6246f491c526211f5405627d564529220e61e848983d8eb9d7f87736" title="Smartie sorter is running automatically.">SYS_MODE_RUNNING</a>:
<a name="l00537"></a>00537             <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#d5b7e91c9a338f631520d1bad5912c8e" title="Stores the last mode for transition steps.">mode_last</a> != <a class="code" href="system_8h.html#6e4cea4b6246f491c526211f5405627d564529220e61e848983d8eb9d7f87736" title="Smartie sorter is running automatically.">SYS_MODE_RUNNING</a>) { <span class="comment">/* if we just started to run */</span>
<a name="l00538"></a>00538                 ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#d5b7e91c9a338f631520d1bad5912c8e" title="Stores the last mode for transition steps.">mode_last</a> = <a class="code" href="system_8h.html#6e4cea4b6246f491c526211f5405627d564529220e61e848983d8eb9d7f87736" title="Smartie sorter is running automatically.">SYS_MODE_RUNNING</a>;
<a name="l00539"></a>00539                 menu_current = &amp;men_running;
<a name="l00540"></a>00540 <span class="preprocessor">#if !DEBUG</span>
<a name="l00541"></a>00541 <span class="preprocessor"></span>                <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,0); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(menu_current-&gt;<a class="code" href="structmenu__entry__t.html#775b6ff7a7787b730066cba76532a32d" title="Text on Display (Max 24 Characters, 2 lines).">text</a>[0]);
<a name="l00542"></a>00542                 <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(menu_current-&gt;<a class="code" href="structmenu__entry__t.html#775b6ff7a7787b730066cba76532a32d" title="Text on Display (Max 24 Characters, 2 lines).">text</a>[1]);
<a name="l00543"></a>00543 <span class="preprocessor">#endif</span>
<a name="l00544"></a>00544 <span class="preprocessor"></span><span class="preprocessor">#if DEBUG</span>
<a name="l00545"></a>00545 <span class="preprocessor"></span>                <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,0); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(MEN_TIT_EMPTY);
<a name="l00546"></a>00546                 <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(MEN_TIT_EMPTY);
<a name="l00547"></a>00547 <span class="preprocessor">#endif</span>
<a name="l00548"></a>00548 <span class="preprocessor"></span>                ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#48ef78a306bf18012f7621ce4918b423" title="detecting colors and position catcher">I</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b0338a176a30f108279905bb42b5f80ad22" title="Setting a module&amp;#39;s state to this will start the device to work.">stat_start_working</a>;
<a name="l00549"></a>00549                 ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#fdb071a3fec04fedd7c6b65ecf627087" title="positioning revolver">II</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>;
<a name="l00550"></a>00550                 ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#8177fdec77832c82cf018a948a1d7ec0" title="begin new mode cycle">III</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>;
<a name="l00551"></a>00551             }
<a name="l00552"></a>00552 
<a name="l00553"></a>00553             <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#48ef78a306bf18012f7621ce4918b423" title="detecting colors and position catcher">I</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b0338a176a30f108279905bb42b5f80ad22" title="Setting a module&amp;#39;s state to this will start the device to work.">stat_start_working</a>) { <span class="comment">/* Initiate all work to be done: TCS */</span>
<a name="l00554"></a>00554                 ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#48ef78a306bf18012f7621ce4918b423" title="detecting colors and position catcher">I</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b03b1cdb8bf66313ecce10a4b1c240ea569" title="Indicates the device is busy. The device will automatically change to this state...">stat_working</a>;             
<a name="l00555"></a>00555                 <a class="code" href="system_8c.html#895d4e598ce146273eb5dc50e5a140ea" title="Initiates the color detection by the TCS color sensor.">sensor_tcs_get_color</a>();
<a name="l00556"></a>00556             }
<a name="l00557"></a>00557             <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#48ef78a306bf18012f7621ce4918b423" title="detecting colors and position catcher">I</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b03b1cdb8bf66313ecce10a4b1c240ea569" title="Indicates the device is busy. The device will automatically change to this state...">stat_working</a>) { <span class="comment">/* Wait until is finished: TCS */</span>
<a name="l00558"></a>00558                 <span class="keywordflow">if</span> ( (ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#6cf7d985b536f4551302359ddb90c802" title="The current status of the color sensor.">status</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) &amp;&amp; (ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#a7f30fead1929b6ef4c7923fff04ec46" title="The status before current status.">status_last</a> != <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>)) {
<a name="l00559"></a>00559                     ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#a7f30fead1929b6ef4c7923fff04ec46" title="The status before current status.">status_last</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>;
<a name="l00560"></a>00560                     ss.<a class="code" href="structsmartie__sorter__t.html#94a0cc186fb2a8ca66bfcae1c341a0bb" title="The revolver disc with smarties.">rev</a>.<a class="code" href="structrevolver__t.html#cb200f90913d439f988b778ce7a8f2ea" title="A list of all smarties the revolver contains.">smart</a>[ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>].<a class="code" href="structsmartie__t.html#d6404bb9745efb547327916cfa322788" title="Merged color.">color</a> = ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#645722a2409effbe46339525eba50542" title="The value from the last color detection.">color</a>;
<a name="l00561"></a>00561 <span class="preprocessor">#if DEBUG</span>
<a name="l00562"></a>00562 <span class="preprocessor"></span>                    <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,0); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"I:"</span>); <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a>(ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#645722a2409effbe46339525eba50542" title="The value from the last color detection.">color</a>);
<a name="l00563"></a>00563                     <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(9,0); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"O:"</span>);
<a name="l00564"></a>00564                     temp = <a class="code" href="system_8c.html#03ea663e9ae339039bc5cbcddee52d94" title="Gets the correct out index of the next to drop smartie.">sys_get_out_pos</a>();
<a name="l00565"></a>00565                     <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a>( ss.<a class="code" href="structsmartie__sorter__t.html#94a0cc186fb2a8ca66bfcae1c341a0bb" title="The revolver disc with smarties.">rev</a>.<a class="code" href="structrevolver__t.html#cb200f90913d439f988b778ce7a8f2ea" title="A list of all smarties the revolver contains.">smart</a>[temp].<a class="code" href="structsmartie__t.html#d6404bb9745efb547327916cfa322788" title="Merged color.">color</a> );
<a name="l00566"></a>00566 <span class="preprocessor">#endif</span>
<a name="l00567"></a>00567 <span class="preprocessor"></span><span class="preprocessor">#if !DEBUG</span>
<a name="l00568"></a>00568 <span class="preprocessor"></span>                    <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(8,1); <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a>(ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#645722a2409effbe46339525eba50542" title="The value from the last color detection.">color</a>);
<a name="l00569"></a>00569 <span class="preprocessor">#endif </span>
<a name="l00570"></a>00570 <span class="preprocessor"></span>                }
<a name="l00571"></a>00571                 
<a name="l00572"></a>00572                 <span class="keywordflow">if</span> ( (ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#a7f30fead1929b6ef4c7923fff04ec46" title="The status before current status.">status_last</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) &amp;&amp; (ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#6cf7d985b536f4551302359ddb90c802" title="The current status of the color sensor.">status</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) ) {
<a name="l00573"></a>00573 <span class="preprocessor">#if DEBUG</span>
<a name="l00574"></a>00574 <span class="preprocessor"></span>                    <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); 
<a name="l00575"></a>00575                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"C:"</span>); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>,s,10));
<a name="l00576"></a>00576                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"="</span>); <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a>(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>);
<a name="l00577"></a>00577                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"R:"</span>); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>,s,10));
<a name="l00578"></a>00578                     <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a> &lt; 9) <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>);
<a name="l00579"></a>00579 <span class="preprocessor">#endif</span>
<a name="l00580"></a>00580 <span class="preprocessor"></span>                    ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#48ef78a306bf18012f7621ce4918b423" title="detecting colors and position catcher">I</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b038200fdccabe0d9e135d68523c729b1c5" title="Setting a device to this state will stop the device.">stat_stop_working</a>;
<a name="l00581"></a>00581                 }
<a name="l00582"></a>00582             }
<a name="l00583"></a>00583             <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#48ef78a306bf18012f7621ce4918b423" title="detecting colors and position catcher">I</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b038200fdccabe0d9e135d68523c729b1c5" title="Setting a device to this state will stop the device.">stat_stop_working</a>) {
<a name="l00584"></a>00584                 ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#48ef78a306bf18012f7621ce4918b423" title="detecting colors and position catcher">I</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>;
<a name="l00585"></a>00585                 ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#fdb071a3fec04fedd7c6b65ecf627087" title="positioning revolver">II</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b0338a176a30f108279905bb42b5f80ad22" title="Setting a module&amp;#39;s state to this will start the device to work.">stat_start_working</a>;
<a name="l00586"></a>00586             }
<a name="l00587"></a>00587             <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#fdb071a3fec04fedd7c6b65ecf627087" title="positioning revolver">II</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b0338a176a30f108279905bb42b5f80ad22" title="Setting a module&amp;#39;s state to this will start the device to work.">stat_start_working</a>) { <span class="comment">/* Initiate all work to be done: Catcher */</span>
<a name="l00588"></a>00588 <span class="preprocessor">#if DEBUG</span>
<a name="l00589"></a>00589 <span class="preprocessor"></span>                <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); 
<a name="l00590"></a>00590                 <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"C:"</span>); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>,s,10));
<a name="l00591"></a>00591                 <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"="</span>); <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a>(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>);
<a name="l00592"></a>00592                 <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"R:"</span>); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>,s,10));
<a name="l00593"></a>00593                 <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a> &lt; 9) <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>);
<a name="l00594"></a>00594 <span class="preprocessor">#endif</span>
<a name="l00595"></a>00595 <span class="preprocessor"></span>                ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#fdb071a3fec04fedd7c6b65ecf627087" title="positioning revolver">II</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b03b1cdb8bf66313ecce10a4b1c240ea569" title="Indicates the device is busy. The device will automatically change to this state...">stat_working</a>;
<a name="l00596"></a>00596                 index_temp = <a class="code" href="system_8c.html#03ea663e9ae339039bc5cbcddee52d94" title="Gets the correct out index of the next to drop smartie.">sys_get_out_pos</a>(); 
<a name="l00597"></a>00597                 col_temp = ss.<a class="code" href="structsmartie__sorter__t.html#94a0cc186fb2a8ca66bfcae1c341a0bb" title="The revolver disc with smarties.">rev</a>.<a class="code" href="structrevolver__t.html#cb200f90913d439f988b778ce7a8f2ea" title="A list of all smarties the revolver contains.">smart</a>[index_temp].<a class="code" href="structsmartie__t.html#d6404bb9745efb547327916cfa322788" title="Merged color.">color</a>;
<a name="l00598"></a>00598                 <a class="code" href="system_8c.html#97b11d5bfac2abcab58401879440e202" title="Rotates the catcher to a certain position.">catcher_rotate_absolute</a>(col_temp);
<a name="l00599"></a>00599 
<a name="l00600"></a>00600 <span class="preprocessor">#if !DEBUG</span>
<a name="l00601"></a>00601 <span class="preprocessor"></span>                <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(18,1); <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a>(ss.<a class="code" href="structsmartie__sorter__t.html#94a0cc186fb2a8ca66bfcae1c341a0bb" title="The revolver disc with smarties.">rev</a>.<a class="code" href="structrevolver__t.html#cb200f90913d439f988b778ce7a8f2ea" title="A list of all smarties the revolver contains.">smart</a>[index_temp].<a class="code" href="structsmartie__t.html#d6404bb9745efb547327916cfa322788" title="Merged color.">color</a>);
<a name="l00602"></a>00602 <span class="preprocessor">#endif</span>
<a name="l00603"></a>00603 <span class="preprocessor"></span><span class="preprocessor">#if DEBUG</span>
<a name="l00604"></a>00604 <span class="preprocessor"></span>                <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); 
<a name="l00605"></a>00605                 <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"C:"</span>); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>,s,10));
<a name="l00606"></a>00606                 <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"="</span>); <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a>(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>);
<a name="l00607"></a>00607                 <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"R:"</span>); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>,s,10));
<a name="l00608"></a>00608                 <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a> &lt; 9) <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>);
<a name="l00609"></a>00609 <span class="preprocessor">#endif</span>
<a name="l00610"></a>00610 <span class="preprocessor"></span>            }
<a name="l00611"></a>00611             <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#fdb071a3fec04fedd7c6b65ecf627087" title="positioning revolver">II</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b03b1cdb8bf66313ecce10a4b1c240ea569" title="Indicates the device is busy. The device will automatically change to this state...">stat_working</a>) { <span class="comment">/* Wait until is finished: Catcher */</span>
<a name="l00612"></a>00612                 <span class="keywordflow">if</span> ( (ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#71c0bbc3adc7f7f200e6853fd361c12d" title="Status.">status</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) &amp;&amp; (ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> != <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>)) {
<a name="l00613"></a>00613                     ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>;
<a name="l00614"></a>00614 <span class="preprocessor">#if DEBUG</span>
<a name="l00615"></a>00615 <span class="preprocessor"></span>                    <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); 
<a name="l00616"></a>00616                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"C:"</span>); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>,s,10));
<a name="l00617"></a>00617                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"="</span>); <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a>(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>);
<a name="l00618"></a>00618                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"R:"</span>); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>,s,10));
<a name="l00619"></a>00619                     <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a> &lt; 9) <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>);
<a name="l00620"></a>00620 <span class="preprocessor">#endif</span>
<a name="l00621"></a>00621 <span class="preprocessor"></span>                }
<a name="l00622"></a>00622 
<a name="l00623"></a>00623                 <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) {
<a name="l00624"></a>00624 <span class="preprocessor">#if DEBUG</span>
<a name="l00625"></a>00625 <span class="preprocessor"></span>                    <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); 
<a name="l00626"></a>00626                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"C:"</span>); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>,s,10));
<a name="l00627"></a>00627                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"="</span>); <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a>(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>);
<a name="l00628"></a>00628                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"R:"</span>); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>,s,10));
<a name="l00629"></a>00629                     <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a> &lt; 9) <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>);
<a name="l00630"></a>00630 <span class="preprocessor">#endif</span>
<a name="l00631"></a>00631 <span class="preprocessor"></span>                    ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#fdb071a3fec04fedd7c6b65ecf627087" title="positioning revolver">II</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b038200fdccabe0d9e135d68523c729b1c5" title="Setting a device to this state will stop the device.">stat_stop_working</a>;
<a name="l00632"></a>00632                 }
<a name="l00633"></a>00633             }
<a name="l00634"></a>00634             <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#fdb071a3fec04fedd7c6b65ecf627087" title="positioning revolver">II</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b038200fdccabe0d9e135d68523c729b1c5" title="Setting a device to this state will stop the device.">stat_stop_working</a>) {
<a name="l00635"></a>00635                 ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#fdb071a3fec04fedd7c6b65ecf627087" title="positioning revolver">II</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>;
<a name="l00636"></a>00636                 ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#8177fdec77832c82cf018a948a1d7ec0" title="begin new mode cycle">III</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b0338a176a30f108279905bb42b5f80ad22" title="Setting a module&amp;#39;s state to this will start the device to work.">stat_start_working</a>;
<a name="l00637"></a>00637 <span class="preprocessor">#if DEBUG</span>
<a name="l00638"></a>00638 <span class="preprocessor"></span>                <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); 
<a name="l00639"></a>00639                 <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"C:"</span>); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>,s,10));
<a name="l00640"></a>00640                 <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"="</span>); <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a>(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>);
<a name="l00641"></a>00641                 <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"R:"</span>); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>,s,10));
<a name="l00642"></a>00642                 <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a> &lt; 9) <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>);
<a name="l00643"></a>00643 <span class="preprocessor">#endif</span>
<a name="l00644"></a>00644 <span class="preprocessor"></span>            }
<a name="l00645"></a>00645 
<a name="l00646"></a>00646             <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#8177fdec77832c82cf018a948a1d7ec0" title="begin new mode cycle">III</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b0338a176a30f108279905bb42b5f80ad22" title="Setting a module&amp;#39;s state to this will start the device to work.">stat_start_working</a>) { <span class="comment">/* Initiate all work to be done: Revolver &amp; vibrator */</span>
<a name="l00647"></a>00647                 ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#8177fdec77832c82cf018a948a1d7ec0" title="begin new mode cycle">III</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b03b1cdb8bf66313ecce10a4b1c240ea569" title="Indicates the device is busy. The device will automatically change to this state...">stat_working</a>;
<a name="l00648"></a>00648                 <a class="code" href="system_8c.html#ef389e924ee5fb5cb82da6c6a11209b5" title="Initiates the vibrator to start.">vibrator_start</a>();
<a name="l00649"></a>00649                 <a class="code" href="system_8c.html#4312b8582a99de2443c53adce9359dc5" title="Rotates the revolver from the current position to a relative next position regarding...">revolver_rotate_relative</a>(1);
<a name="l00650"></a>00650 <span class="preprocessor">#if DEBUG</span>
<a name="l00651"></a>00651 <span class="preprocessor"></span>                <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); 
<a name="l00652"></a>00652                 <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"C:"</span>); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>,s,10));
<a name="l00653"></a>00653                 <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"="</span>); <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a>(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>);
<a name="l00654"></a>00654                 <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"R:"</span>); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>,s,10));
<a name="l00655"></a>00655                 <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a> &lt; 9) <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>);
<a name="l00656"></a>00656 <span class="preprocessor">#endif</span>
<a name="l00657"></a>00657 <span class="preprocessor"></span>            }
<a name="l00658"></a>00658             <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#8177fdec77832c82cf018a948a1d7ec0" title="begin new mode cycle">III</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b03b1cdb8bf66313ecce10a4b1c240ea569" title="Indicates the device is busy. The device will automatically change to this state...">stat_working</a>) { <span class="comment">/* Wait until is finished: Revolver &amp; vibrator */</span>
<a name="l00659"></a>00659                 <span class="keywordflow">if</span> ( (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#71c0bbc3adc7f7f200e6853fd361c12d" title="Status.">status</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) &amp;&amp; (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> != <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) ) { 
<a name="l00660"></a>00660                     ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>;
<a name="l00661"></a>00661 <span class="preprocessor">#if DEBUG</span>
<a name="l00662"></a>00662 <span class="preprocessor"></span>                    <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); 
<a name="l00663"></a>00663                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"C:"</span>); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>,s,10));
<a name="l00664"></a>00664                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"="</span>); <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a>(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>);
<a name="l00665"></a>00665                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"R:"</span>); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>,s,10));
<a name="l00666"></a>00666                     <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a> &lt; 9) <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>);
<a name="l00667"></a>00667 <span class="preprocessor">#endif</span>
<a name="l00668"></a>00668 <span class="preprocessor"></span>                }
<a name="l00669"></a>00669                 <span class="keywordflow">if</span> ( (ss.<a class="code" href="structsmartie__sorter__t.html#aa730d2f15b0f5bc4292378612577a4a" title="Shaker (or vibrator).">vibr</a>.<a class="code" href="structvibrator__t.html#adaff41fc66c7912a53deda23fb63836" title="Status.">status</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) &amp;&amp; (ss.<a class="code" href="structsmartie__sorter__t.html#aa730d2f15b0f5bc4292378612577a4a" title="Shaker (or vibrator).">vibr</a>.<a class="code" href="structvibrator__t.html#76cb1de3fb90a68cd5e9066e8280b918" title="The last status.">status_last</a> != <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) ) {
<a name="l00670"></a>00670                     ss.<a class="code" href="structsmartie__sorter__t.html#aa730d2f15b0f5bc4292378612577a4a" title="Shaker (or vibrator).">vibr</a>.<a class="code" href="structvibrator__t.html#76cb1de3fb90a68cd5e9066e8280b918" title="The last status.">status_last</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>;
<a name="l00671"></a>00671                 }
<a name="l00672"></a>00672                 <span class="keywordflow">if</span> ( (ss.<a class="code" href="structsmartie__sorter__t.html#aa730d2f15b0f5bc4292378612577a4a" title="Shaker (or vibrator).">vibr</a>.<a class="code" href="structvibrator__t.html#76cb1de3fb90a68cd5e9066e8280b918" title="The last status.">status_last</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) &amp;&amp; (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) ) {
<a name="l00673"></a>00673                     ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#8177fdec77832c82cf018a948a1d7ec0" title="begin new mode cycle">III</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b038200fdccabe0d9e135d68523c729b1c5" title="Setting a device to this state will stop the device.">stat_stop_working</a>;
<a name="l00674"></a>00674 <span class="preprocessor">#if DEBUG</span>
<a name="l00675"></a>00675 <span class="preprocessor"></span>                    <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); 
<a name="l00676"></a>00676                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"C:"</span>); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>,s,10));
<a name="l00677"></a>00677                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"="</span>); <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a>(ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>);
<a name="l00678"></a>00678                     <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">"R:"</span>); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(itoa(ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>,s,10));
<a name="l00679"></a>00679                     <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a> &lt; 9) <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(<span class="stringliteral">" "</span>);
<a name="l00680"></a>00680 <span class="preprocessor">#endif</span>
<a name="l00681"></a>00681 <span class="preprocessor"></span>                }
<a name="l00682"></a>00682             } <span class="comment">/* if (ss.state.step.III == stat_working */</span>
<a name="l00683"></a>00683 
<a name="l00684"></a>00684             <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#8177fdec77832c82cf018a948a1d7ec0" title="begin new mode cycle">III</a> == <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b038200fdccabe0d9e135d68523c729b1c5" title="Setting a device to this state will stop the device.">stat_stop_working</a>) {
<a name="l00685"></a>00685                 ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#8177fdec77832c82cf018a948a1d7ec0" title="begin new mode cycle">III</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>;
<a name="l00686"></a>00686                 ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#3ce91eb47370ddf1107ad2d1cd369255" title="Stores the current step of the mode.">step</a>.<a class="code" href="structsystem__step__t.html#48ef78a306bf18012f7621ce4918b423" title="detecting colors and position catcher">I</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b0338a176a30f108279905bb42b5f80ad22" title="Setting a module&amp;#39;s state to this will start the device to work.">stat_start_working</a>;
<a name="l00687"></a>00687             }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689             <span class="keywordflow">break</span>; <span class="comment">/* SYS_MODE_RUNNING */</span>
<a name="l00690"></a>00690         <span class="keywordflow">default</span>:
<a name="l00691"></a>00691             <span class="keywordflow">break</span>;
<a name="l00692"></a>00692         } <span class="comment">/* switch (ss.mode.state) */</span>
<a name="l00693"></a>00693 
<a name="l00694"></a>00694         <span class="comment">/* Poll for user inputs */</span>
<a name="l00695"></a>00695         <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#20530712b28b29eef3109313b9907bd2" title="The rotary encoder (user input).">rotenc</a>.<a class="code" href="structrotary__encoder__t.html#4c3ef6e33c8b1a62cc0fd62885692e46" title="The amount of detected pushes.">push</a>) {
<a name="l00696"></a>00696             ss.<a class="code" href="structsmartie__sorter__t.html#20530712b28b29eef3109313b9907bd2" title="The rotary encoder (user input).">rotenc</a>.<a class="code" href="structrotary__encoder__t.html#4c3ef6e33c8b1a62cc0fd62885692e46" title="The amount of detected pushes.">push</a> = 0;
<a name="l00697"></a>00697             (*menu_current).function();
<a name="l00698"></a>00698             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,0); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(menu_current-&gt;<a class="code" href="structmenu__entry__t.html#775b6ff7a7787b730066cba76532a32d" title="Text on Display (Max 24 Characters, 2 lines).">text</a>[0]);
<a name="l00699"></a>00699             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(menu_current-&gt;<a class="code" href="structmenu__entry__t.html#775b6ff7a7787b730066cba76532a32d" title="Text on Display (Max 24 Characters, 2 lines).">text</a>[1]);               
<a name="l00700"></a>00700         }
<a name="l00701"></a>00701         <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#20530712b28b29eef3109313b9907bd2" title="The rotary encoder (user input).">rotenc</a>.<a class="code" href="structrotary__encoder__t.html#264955f38189fb291a5698e99acf55df" title="The amount of detected left turns.">left</a>) {
<a name="l00702"></a>00702             ss.<a class="code" href="structsmartie__sorter__t.html#20530712b28b29eef3109313b9907bd2" title="The rotary encoder (user input).">rotenc</a>.<a class="code" href="structrotary__encoder__t.html#264955f38189fb291a5698e99acf55df" title="The amount of detected left turns.">left</a> = 0;
<a name="l00703"></a>00703             <span class="keywordflow">if</span> (menu_current-&gt;<a class="code" href="structmenu__entry__t.html#a33ea894bce900b283a55202906d8d30" title="Previous Menu item.">prev</a> != NULL)
<a name="l00704"></a>00704                 menu_current = menu_current-&gt;<a class="code" href="structmenu__entry__t.html#a33ea894bce900b283a55202906d8d30" title="Previous Menu item.">prev</a>;
<a name="l00705"></a>00705             <span class="keywordflow">if</span> (menu_current-&gt;<a class="code" href="structmenu__entry__t.html#86a86c4311b6cf6a653cf4d6a814369b" title="If rotary_encoder_t is rotated to left, this functino will be executed (if available)...">l_action</a> != NULL)
<a name="l00706"></a>00706                 menu_current-&gt;<a class="code" href="structmenu__entry__t.html#86a86c4311b6cf6a653cf4d6a814369b" title="If rotary_encoder_t is rotated to left, this functino will be executed (if available)...">l_action</a>();
<a name="l00707"></a>00707             
<a name="l00708"></a>00708             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,0); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(menu_current-&gt;<a class="code" href="structmenu__entry__t.html#775b6ff7a7787b730066cba76532a32d" title="Text on Display (Max 24 Characters, 2 lines).">text</a>[0]);
<a name="l00709"></a>00709             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(menu_current-&gt;<a class="code" href="structmenu__entry__t.html#775b6ff7a7787b730066cba76532a32d" title="Text on Display (Max 24 Characters, 2 lines).">text</a>[1]);               
<a name="l00710"></a>00710         }
<a name="l00711"></a>00711         <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#20530712b28b29eef3109313b9907bd2" title="The rotary encoder (user input).">rotenc</a>.<a class="code" href="structrotary__encoder__t.html#bf888e3b4cc08d5ced47c59224d6aa57" title="The amount of detected right turns.">right</a>) {
<a name="l00712"></a>00712             ss.<a class="code" href="structsmartie__sorter__t.html#20530712b28b29eef3109313b9907bd2" title="The rotary encoder (user input).">rotenc</a>.<a class="code" href="structrotary__encoder__t.html#bf888e3b4cc08d5ced47c59224d6aa57" title="The amount of detected right turns.">right</a> = 0;
<a name="l00713"></a>00713             <span class="keywordflow">if</span> (menu_current-&gt;<a class="code" href="structmenu__entry__t.html#e058b44f1f4805e1e9cf58ac9c8c684d" title="Next menu item.">next</a> != NULL)
<a name="l00714"></a>00714                 menu_current = menu_current-&gt;<a class="code" href="structmenu__entry__t.html#e058b44f1f4805e1e9cf58ac9c8c684d" title="Next menu item.">next</a>;
<a name="l00715"></a>00715             <span class="keywordflow">if</span> (menu_current-&gt;<a class="code" href="structmenu__entry__t.html#46655e92352000076fa2ad174d5c051e" title="If rotary_encoder_t is rotated to right, this functino will be executed (if available)...">r_action</a> != NULL)
<a name="l00716"></a>00716                 menu_current-&gt;<a class="code" href="structmenu__entry__t.html#46655e92352000076fa2ad174d5c051e" title="If rotary_encoder_t is rotated to right, this functino will be executed (if available)...">r_action</a>();
<a name="l00717"></a>00717             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,0); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(menu_current-&gt;<a class="code" href="structmenu__entry__t.html#775b6ff7a7787b730066cba76532a32d" title="Text on Display (Max 24 Characters, 2 lines).">text</a>[0]);
<a name="l00718"></a>00718             <a class="code" href="lcd__display_8c.html#dbf47a5efdf02367ded1ebf8f9edb5fe" title="Set cursor to specified position.">lcd_gotoxy</a>(0,1); <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(menu_current-&gt;<a class="code" href="structmenu__entry__t.html#775b6ff7a7787b730066cba76532a32d" title="Text on Display (Max 24 Characters, 2 lines).">text</a>[1]);               
<a name="l00719"></a>00719         }
<a name="l00720"></a>00720     } <span class="comment">/* Main loop end */</span>
<a name="l00721"></a>00721     <span class="keywordflow">return</span> 0;
<a name="l00722"></a>00722 }
<a name="l00723"></a>00723 
<a name="l00727"></a><a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98">00727</a> <span class="keywordtype">void</span> <a class="code" href="smarties2_8c.html#a7a521eea3183f542ce7cb5cf3988e98" title="Writes the color to the current postion of the display.">smartie_lcd_write_color</a> (smartie_color color) {
<a name="l00728"></a>00728     <span class="keywordflow">switch</span> (color) {
<a name="l00729"></a>00729     <span class="keywordflow">case</span> <a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b2b41b78747aaed535dfae65498e06ad26" title="Yellow.">col_yellow</a>:
<a name="l00730"></a>00730         <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(MEN_COL_YELLOW);
<a name="l00731"></a>00731         <span class="keywordflow">break</span>;
<a name="l00732"></a>00732     <span class="keywordflow">case</span> <a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b2b5a96dd4664a6aeab46c81b3f7e357be" title="Blue.">col_blue</a>:
<a name="l00733"></a>00733         <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(MEN_COL_BLUE);
<a name="l00734"></a>00734         <span class="keywordflow">break</span>;
<a name="l00735"></a>00735     <span class="keywordflow">case</span> <a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b256708c6b715321f832ce4ca7426a3b31" title="Brown.">col_brown</a>:
<a name="l00736"></a>00736         <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(MEN_COL_BROWN);
<a name="l00737"></a>00737         <span class="keywordflow">break</span>;
<a name="l00738"></a>00738     <span class="keywordflow">case</span> <a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b26a0e2721ce49eab7403f47519fc0ef64" title="Green.">col_green</a>:
<a name="l00739"></a>00739         <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(MEN_COL_GREEN);
<a name="l00740"></a>00740         <span class="keywordflow">break</span>;
<a name="l00741"></a>00741     <span class="keywordflow">case</span> <a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b25cdf68f9bbce4f120d93db95e584146c" title="Orange.">col_orange</a>:
<a name="l00742"></a>00742         <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(MEN_COL_ORANGE);
<a name="l00743"></a>00743         <span class="keywordflow">break</span>;
<a name="l00744"></a>00744     <span class="keywordflow">case</span> <a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b278bb2430f9b464e19f321964a6e75aa2" title="Pink.">col_pink</a>:
<a name="l00745"></a>00745         <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(MEN_COL_PINK);
<a name="l00746"></a>00746         <span class="keywordflow">break</span>;
<a name="l00747"></a>00747     <span class="keywordflow">case</span> <a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b229840715f465dff615d65002c94f5cfc" title="Purple.">col_purple</a>:
<a name="l00748"></a>00748         <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(MEN_COL_PURPLE);
<a name="l00749"></a>00749         <span class="keywordflow">break</span>;
<a name="l00750"></a>00750     <span class="keywordflow">case</span> <a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b2f3023a6d67057a1b646478eb80619db2" title="Red.">col_red</a>:
<a name="l00751"></a>00751         <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(MEN_COL_RED);
<a name="l00752"></a>00752         <span class="keywordflow">break</span>;
<a name="l00753"></a>00753     <span class="keywordflow">default</span>:
<a name="l00754"></a>00754         <a class="code" href="lcd__display_8c.html#8ffdfcac7638368ff04364c14984266e" title="Display string without auto linefeed.">lcd_puts</a>(MEN_COL_UNKNOWN);
<a name="l00755"></a>00755         <span class="keywordflow">break</span>;
<a name="l00756"></a>00756     }
<a name="l00757"></a>00757 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Aug 29 13:48:09 2008 for Smarties2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
