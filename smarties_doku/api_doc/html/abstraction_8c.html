<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Smarties2: abstraction.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>abstraction.c File Reference</h1><code>#include &quot;abstraction.h&quot;</code><br>
<code>#include &quot;<a class="el" href="system_8h-source.html">system.h</a>&quot;</code><br>
<code>#include &lt;math.h&gt;</code><br>

<p>
<div class="dynheader">
Include dependency graph for abstraction.c:</div>
<div class="dynsection">
<p><center><img src="abstraction_8c__incl.png" border="0" usemap="#abstraction.c_map" alt=""></center>
<map name="abstraction.c_map">
<area shape="rect" href="abstraction_8h-source.html" title="abstraction.h" alt="" coords="5,80,101,107"><area shape="rect" href="system_8h.html" title="Smarites machine API header file." alt="" coords="125,80,200,107"></map>
</div>

<p>
<a href="abstraction_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstraction_8c.html#b45f6a6990e7755a39cc6279e3c09abf">motor_stuff</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Takes controll over the catcher and revolver stepper engines.  <a href="#b45f6a6990e7755a39cc6279e3c09abf"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstraction_8c.html#6a89fa3c3d8ffcbc9f381e23b1d1cb1d">rotary_encoder_stuff</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Takes controll over the rotary encoder (user input) device.  <a href="#6a89fa3c3d8ffcbc9f381e23b1d1cb1d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstraction_8c.html#acf290466c264ff9b7443af87b69f495">lightbarrier_stuff</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Take control over the lightbarriers.  <a href="#acf290466c264ff9b7443af87b69f495"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstraction_8c.html#232e74ae3db0daad7e58f233907e3108">sensor_tcs_stuff</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Takes control over the TCS color sensor.  <a href="#232e74ae3db0daad7e58f233907e3108"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="abstraction_8c.html#7df6f23828e5b8328cf5f5f1d6e06ac2">vibrator_stuff</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Takes control over the shaker (vibrator) device.  <a href="#7df6f23828e5b8328cf5f5f1d6e06ac2"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
All these functions are expected to be called every millisecond by the function ISR (TIMER0_OVF_vect) in the file my_interrupt.c 
<p>Definition in file <a class="el" href="abstraction_8c-source.html">abstraction.c</a>.</p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="acf290466c264ff9b7443af87b69f495"></a><!-- doxytag: member="abstraction.c::lightbarrier_stuff" ref="acf290466c264ff9b7443af87b69f495" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lightbarrier_stuff           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Take control over the lightbarriers. 
<p>
This function is expected to be called regulary. It polls the input pins of the lightbarrier and sets the corresponding flags of lightbarrier struct. This function assumes that lightbarriers are always enabled. 
<p>Definition at line <a class="el" href="abstraction_8c-source.html#l00236">236</a> of file <a class="el" href="abstraction_8c-source.html">abstraction.c</a>.</p>

<p>References <a class="el" href="system_8h-source.html#l00233">IS_LB_CATCHER</a>, <a class="el" href="system_8h-source.html#l00234">IS_LB_REVOLVER</a>, <a class="el" href="system_8h-source.html#l00356">lb_blocked</a>, <a class="el" href="system_8h-source.html#l00446">smartie_sorter_t::lb_catcher</a>, <a class="el" href="system_8h-source.html#l00355">lb_free</a>, <a class="el" href="system_8h-source.html#l00447">smartie_sorter_t::lb_revolver</a>, <a class="el" href="system_8h-source.html#l00365">lightbarrier_t::passes</a>, <a class="el" href="system_8h-source.html#l00363">lightbarrier_t::status</a>, and <a class="el" href="system_8h-source.html#l00364">lightbarrier_t::status_last</a>.</p>

<p>Referenced by <a class="el" href="interrupt_8c-source.html#l00017">ISR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="b45f6a6990e7755a39cc6279e3c09abf"></a><!-- doxytag: member="abstraction.c::motor_stuff" ref="b45f6a6990e7755a39cc6279e3c09abf" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void motor_stuff           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Takes controll over the catcher and revolver stepper engines. 
<p>
The ramp up is made by linear shrinking the time period t for each step: <div class="fragment"><pre class="fragment">  Steps
  ^
  |         4t                 3t       2t   t  t  t  t
  *                       *           *     *  *  *  *  *
  |  
  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+-&gt; Time
  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18
 
 Symbolic diagram, no real values
</pre></div><p>
This function is expected to be called every millisecond to work properly.<p>
Important setting values are:<ul>
<li>CATCH_STEP_DURATION</li><li>CATCH_RAMP_DURATION</li><li>REV_STEP_DURATION</li><li>REV_RAMP_DURATION </li></ul>

<p>Definition at line <a class="el" href="abstraction_8c-source.html#l00068">68</a> of file <a class="el" href="abstraction_8c-source.html">abstraction.c</a>.</p>

<p>References <a class="el" href="system_8h-source.html#l00444">smartie_sorter_t::mot_catcher</a>, and <a class="el" href="system_8h-source.html#l00445">smartie_sorter_t::mot_revolver</a>.</p>

<p>Referenced by <a class="el" href="interrupt_8c-source.html#l00017">ISR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="6a89fa3c3d8ffcbc9f381e23b1d1cb1d"></a><!-- doxytag: member="abstraction.c::rotary_encoder_stuff" ref="6a89fa3c3d8ffcbc9f381e23b1d1cb1d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rotary_encoder_stuff           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Takes controll over the rotary encoder (user input) device. 
<p>
This function is expected to be called regulary. It polls the input pins for the rotary encoder and sets the corresponding flags of the rotary_encoder struct. 
<p>Definition at line <a class="el" href="abstraction_8c-source.html#l00170">170</a> of file <a class="el" href="abstraction_8c-source.html">abstraction.c</a>.</p>

<p>References <a class="el" href="system_8h-source.html#l00220">IS_ROTENC_A</a>, <a class="el" href="system_8h-source.html#l00222">IS_ROTENC_AB</a>, <a class="el" href="system_8h-source.html#l00221">IS_ROTENC_B</a>, <a class="el" href="system_8h-source.html#l00223">IS_ROTENC_NONE</a>, <a class="el" href="system_8h-source.html#l00224">IS_ROTENC_PUSH</a>, <a class="el" href="system_8h-source.html#l00316">rotary_encoder_t::left</a>, <a class="el" href="system_8h-source.html#l00314">rotary_encoder_t::push</a>, <a class="el" href="system_8h-source.html#l00317">rotary_encoder_t::pushtmp</a>, <a class="el" href="system_8h-source.html#l00315">rotary_encoder_t::right</a>, <a class="el" href="system_8h-source.html#l00449">smartie_sorter_t::rotenc</a>, <a class="el" href="system_8h-source.html#l00305">ROTENC_A</a>, <a class="el" href="system_8h-source.html#l00306">ROTENC_B</a>, <a class="el" href="system_8h-source.html#l00307">ROTENC_BOTH</a>, <a class="el" href="system_8h-source.html#l00303">ROTENC_NONE</a>, <a class="el" href="system_8h-source.html#l00304">ROTENC_PUSH</a>, and <a class="el" href="system_8h-source.html#l00318">rotary_encoder_t::rottmp</a>.</p>

<p>Referenced by <a class="el" href="interrupt_8c-source.html#l00017">ISR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="232e74ae3db0daad7e58f233907e3108"></a><!-- doxytag: member="abstraction.c::sensor_tcs_stuff" ref="232e74ae3db0daad7e58f233907e3108" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sensor_tcs_stuff           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Takes control over the TCS color sensor. 
<p>
This function is expected to be called exectly every millisecond to work properly. This function will read the current color of the smartie.<p>
About the way of color detection please refere to the Main page 
<p>Definition at line <a class="el" href="abstraction_8c-source.html#l00283">283</a> of file <a class="el" href="abstraction_8c-source.html">abstraction.c</a>.</p>

<p>References <a class="el" href="system_8h-source.html#l00330">col_blue</a>, <a class="el" href="system_8h-source.html#l00331">col_green</a>, <a class="el" href="system_8h-source.html#l00332">col_red</a>, <a class="el" href="system_8h-source.html#l00080">COL_SENS_TCS_DISABLE</a>, <a class="el" href="system_8h-source.html#l00078">COL_SENS_TCS_ENABLE</a>, <a class="el" href="system_8h-source.html#l00083">COL_SENS_TCS_FREQ_MESURE_DI</a>, <a class="el" href="system_8h-source.html#l00082">COL_SENS_TCS_FREQ_MESURE_EN</a>, <a class="el" href="system_8h-source.html#l00076">COL_SENS_TCS_SAMPLE_TIME</a>, <a class="el" href="system_8h-source.html#l00116">COL_SENS_TCS_SET_FILTER</a>, <a class="el" href="system_8h-source.html#l00338">col_unknown</a>, <a class="el" href="system_8h-source.html#l00408">color_sensor_tcs_t::color</a>, <a class="el" href="system_8h-source.html#l00415">color_sensor_tcs_t::distance</a>, <a class="el" href="system_8h-source.html#l00410">color_sensor_tcs_t::filter_freq_blue</a>, <a class="el" href="system_8h-source.html#l00411">color_sensor_tcs_t::filter_freq_green</a>, <a class="el" href="system_8h-source.html#l00413">color_sensor_tcs_t::filter_freq_none</a>, <a class="el" href="system_8h-source.html#l00412">color_sensor_tcs_t::filter_freq_red</a>, <a class="el" href="system_8h-source.html#l00443">smartie_sorter_t::sens_tcs</a>, <a class="el" href="system_8h-source.html#l00414">color_sensor_tcs_t::slopes</a>, <a class="el" href="system_8h-source.html#l00257">stat_finished</a>, <a class="el" href="system_8h-source.html#l00253">stat_idle</a>, <a class="el" href="system_8h-source.html#l00254">stat_start_working</a>, <a class="el" href="system_8h-source.html#l00256">stat_stop_working</a>, <a class="el" href="system_8h-source.html#l00255">stat_working</a>, <a class="el" href="system_8h-source.html#l00406">color_sensor_tcs_t::status</a>, <a class="el" href="system_8h-source.html#l00407">color_sensor_tcs_t::status_last</a>, and <a class="el" href="system_8h-source.html#l00409">color_sensor_tcs_t::time</a>.</p>

<p>Referenced by <a class="el" href="interrupt_8c-source.html#l00017">ISR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="7df6f23828e5b8328cf5f5f1d6e06ac2"></a><!-- doxytag: member="abstraction.c::vibrator_stuff" ref="7df6f23828e5b8328cf5f5f1d6e06ac2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vibrator_stuff           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Takes control over the shaker (vibrator) device. 
<p>
This function is expected to be called regulary. It polls the input pins of the shaker and sets the corresponding flags of the shaker struct. This function assumes that 
<p>Definition at line <a class="el" href="abstraction_8c-source.html#l00428">428</a> of file <a class="el" href="abstraction_8c-source.html">abstraction.c</a>.</p>

<p>References <a class="el" href="system_8h-source.html#l00424">vibrator_t::duration</a>, <a class="el" href="system_8h-source.html#l00257">stat_finished</a>, <a class="el" href="system_8h-source.html#l00253">stat_idle</a>, <a class="el" href="system_8h-source.html#l00254">stat_start_working</a>, <a class="el" href="system_8h-source.html#l00256">stat_stop_working</a>, <a class="el" href="system_8h-source.html#l00255">stat_working</a>, <a class="el" href="system_8h-source.html#l00422">vibrator_t::status</a>, <a class="el" href="system_8h-source.html#l00423">vibrator_t::status_last</a>, <a class="el" href="system_8h-source.html#l00448">smartie_sorter_t::vibr</a>, <a class="el" href="system_8h-source.html#l00204">VIBR_DURATION</a>, <a class="el" href="system_8h-source.html#l00201">VIBR_OFF</a>, and <a class="el" href="system_8h-source.html#l00200">VIBR_ON</a>.</p>

<p>Referenced by <a class="el" href="interrupt_8c-source.html#l00017">ISR()</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Aug 29 13:48:09 2008 for Smarties2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
