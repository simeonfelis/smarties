<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Smarties2: system.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
<h1>system.c</h1><a href="system_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;avr/eeprom.h&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include "<a class="code" href="system_8h.html" title="Smarites machine API header file.">system.h</a>"</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="menu_8h.html" title="The menu structure and handling.">menu.h</a>"</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="keyword">extern</span> <a class="code" href="structsmartie__sorter__t.html" title="All devices from the smartie sorter collected to one bundle.">smartie_sorter</a> ss;
<a name="l00013"></a>00013 <span class="keyword">extern</span> <a class="code" href="structmenu__entry__t.html" title="The menu structure.">menu_entry</a> *menu_current;
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 
<a name="l00022"></a><a class="code" href="system_8h.html#fcc5a33541d29a2d114643e67b7a5e68">00022</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#fcc5a33541d29a2d114643e67b7a5e68" title="Will set the current menu to the upper menu layer.">sys_enter_topmenu</a> () {
<a name="l00023"></a>00023     menu_current = menu_current-&gt;<a class="code" href="structmenu__entry__t.html#c0b6b7d88e004c1c64f99cae93d0f57e" title="The menu item above of current menu item.">topmenu</a>;
<a name="l00024"></a>00024     ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> = <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc556ab1bff0b64b5014a737f2598e75a2ef" title="No program executed.">prog_none</a>; <span class="comment">/* exit any program if we were executing one */</span>
<a name="l00025"></a>00025 }
<a name="l00026"></a>00026 
<a name="l00033"></a><a class="code" href="system_8h.html#5e456b56f0c2ce2d53923272af0ad333">00033</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#5e456b56f0c2ce2d53923272af0ad333" title="Will set the current menu to to lower menu layer.">sys_enter_submenu</a> () {
<a name="l00034"></a>00034     menu_current = menu_current-&gt;<a class="code" href="structmenu__entry__t.html#d325ca30c2993cd5496fcebac7a14085" title="The menu item below of current menu item.">submenu</a>;
<a name="l00035"></a>00035     ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> = <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc556ab1bff0b64b5014a737f2598e75a2ef" title="No program executed.">prog_none</a>; <span class="comment">/* exit any program if we were executing one */</span>
<a name="l00036"></a>00036 }
<a name="l00037"></a>00037 
<a name="l00044"></a><a class="code" href="system_8h.html#e2936ed52c758b103718c0101d5133df">00044</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#e2936ed52c758b103718c0101d5133df" title="Diables (power off) the catcher stepper motor.">sys_catcher_disable</a> () {
<a name="l00045"></a>00045     <a class="code" href="system_8h.html#dbaa422e514d133a6254ba84cbd1c656" title="Disables the driver for the steper motor.">CATCH_DISABLE</a>;
<a name="l00046"></a>00046 }
<a name="l00047"></a>00047 
<a name="l00054"></a><a class="code" href="system_8h.html#a740aed754b50165fb058dad9713f2f8">00054</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#a740aed754b50165fb058dad9713f2f8" title="Enables (power on) the catcher stepper motor.">sys_catcher_enable</a> () {
<a name="l00055"></a>00055     <a class="code" href="system_8h.html#cbb9435cdc9b7d2ea5c42461635ca74b" title="Enables the driver for the steper motor.">CATCH_ENABLE</a>;
<a name="l00056"></a>00056 }
<a name="l00057"></a>00057 
<a name="l00061"></a><a class="code" href="system_8h.html#c8a68f0c5c371bc0f41e3ff4655eb9fa">00061</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#c8a68f0c5c371bc0f41e3ff4655eb9fa" title="Moves the catcher stepper motor for on step.">sys_catcher_move_step</a> () {
<a name="l00062"></a>00062     <a class="code" href="system_8h.html#797c4788553e1516bc35e28ea1cc2faa" title="Move the catcher stepper motor for one single step.">CATCH_MOVE_STEP</a>;
<a name="l00063"></a>00063 }
<a name="l00064"></a>00064 
<a name="l00072"></a><a class="code" href="system_8h.html#75278bd6ede508871b8d7880f24503d8">00072</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#75278bd6ede508871b8d7880f24503d8" title="Rotates the catcher for one position.">sys_catcher_rotate</a>() {
<a name="l00073"></a>00073     <span class="keywordflow">if</span> ( (ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#71c0bbc3adc7f7f200e6853fd361c12d" title="Status.">status</a> != <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) &amp;&amp; (ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> != <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) )
<a name="l00074"></a>00074         <span class="keywordflow">return</span>;
<a name="l00075"></a>00075     
<a name="l00076"></a>00076     ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> = <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc55331eb332ffb09740f70737359d79fff7" title="Indicates that the catcher rotate program is running.">prog_rotate_catcher</a>;
<a name="l00077"></a>00077     <a class="code" href="system_8c.html#2c5ecc52ef42cf3086da340a8e3eae13" title="Rotates the catcher from the current position to a relative next position regarding...">catcher_rotate_relative</a>(1);
<a name="l00078"></a>00078 }
<a name="l00079"></a>00079 
<a name="l00085"></a><a class="code" href="system_8h.html#03ea663e9ae339039bc5cbcddee52d94">00085</a> uint8_t <a class="code" href="system_8c.html#03ea663e9ae339039bc5cbcddee52d94" title="Gets the correct out index of the next to drop smartie.">sys_get_out_pos</a> () {
<a name="l00086"></a>00086     uint8_t ret = ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a> + REV_POS_SMARTIE_OUT;
<a name="l00087"></a>00087     <span class="keywordflow">if</span> (ret &gt;= 12)
<a name="l00088"></a>00088         ret -= <a class="code" href="system_8h.html#388331d885423f07d4a701af481c62a7" title="The amount of smarties (holes) which fit into the revolver.">REV_MAX_SIZE</a>;
<a name="l00089"></a>00089     <span class="keywordflow">return</span> ret; 
<a name="l00090"></a>00090 }
<a name="l00091"></a>00091 
<a name="l00098"></a><a class="code" href="system_8h.html#60124c61aa7941fb311fdb4d85e6ba66">00098</a> int8_t <a class="code" href="system_8c.html#60124c61aa7941fb311fdb4d85e6ba66" title="Returns status for the catcher lightbarrier.">sys_catcher_is_lb_blocked</a> () {
<a name="l00099"></a>00099     <span class="keywordflow">return</span> <a class="code" href="system_8h.html#6e17585fda3598109ead863d76cd4dad" title="Returns TRUE if lightbarrier is blocked.">IS_LB_CATCHER</a>;
<a name="l00100"></a>00100 }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="keywordtype">void</span> sys_revolver_disable () {
<a name="l00104"></a>00104     <a class="code" href="system_8h.html#67839faa4915b278dcac966586cdc3bf" title="Disables the driver for the stepper motor.">REV_DISABLE</a>;
<a name="l00105"></a>00105 }
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 <span class="keywordtype">void</span> sys_revolver_enable () {
<a name="l00108"></a>00108     <a class="code" href="system_8h.html#94ba27b8711c066bedb56c5a2290f372" title="Enables the driver for the stepper motor.">REV_ENABLE</a>;
<a name="l00109"></a>00109 }
<a name="l00110"></a>00110 
<a name="l00118"></a><a class="code" href="system_8h.html#9fcb8a68acbcbb5ab57ca0ea752b5ad6">00118</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#9fcb8a68acbcbb5ab57ca0ea752b5ad6" title="Rotates the revolver for one position.">sys_revolver_rotate</a>() {
<a name="l00119"></a>00119     <span class="keywordflow">if</span> ( (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#71c0bbc3adc7f7f200e6853fd361c12d" title="Status.">status</a> != <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) &amp;&amp; (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> != <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b035ad840e3bfeb7a8c1633431f009ec7fc" title="The module/device is doing nothing and is ready for a new job.">stat_idle</a>) )
<a name="l00120"></a>00120         <span class="keywordflow">return</span>;
<a name="l00121"></a>00121     ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> = <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc55cf735b3ab9ceededb902db503e7271b9" title="Indicates that the revolver rotate program is running.">prog_rotate_revolver</a>;
<a name="l00122"></a>00122     <a class="code" href="system_8c.html#4312b8582a99de2443c53adce9359dc5" title="Rotates the revolver from the current position to a relative next position regarding...">revolver_rotate_relative</a>(1);
<a name="l00123"></a>00123 }
<a name="l00124"></a>00124 
<a name="l00128"></a><a class="code" href="system_8h.html#f98b8357b55993121effd5f8a144db21">00128</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#f98b8357b55993121effd5f8a144db21" title="Moves the revolver for one step.">sys_revolver_move_step</a> () {
<a name="l00129"></a>00129     <a class="code" href="system_8h.html#38e0155b1d66a9e8135bbfddf56ffef4" title="Move the revolver stepper motor for one single step.">REV_MOVE_STEP</a>;
<a name="l00130"></a>00130 }
<a name="l00131"></a>00131 
<a name="l00138"></a><a class="code" href="system_8h.html#768659fc9adb5f8edca3aed8711ef448">00138</a> int8_t <a class="code" href="system_8c.html#768659fc9adb5f8edca3aed8711ef448" title="Returns the status for the revolver lightbarrier.">sys_revolver_is_lb_blocked</a> () {
<a name="l00139"></a>00139     <span class="keywordflow">return</span> <a class="code" href="system_8h.html#f97aa7272a24b34aaf24697d1d0d52ac" title="Returns TRUE if lightbarrier is blocked.">IS_LB_REVOLVER</a>;
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 
<a name="l00149"></a><a class="code" href="system_8h.html#851876925adec6a4c6d7cb6aec4bbbfd">00149</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#851876925adec6a4c6d7cb6aec4bbbfd" title="Will Enter the pause mode.">sys_pause</a>()
<a name="l00150"></a>00150 {
<a name="l00151"></a>00151     <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#903c7b848a8b43a1b50e2fbb54a7cb7d" title="Stores the current mode.">mode</a> == <a class="code" href="system_8h.html#6e4cea4b6246f491c526211f5405627df1c8a041b6d3d46002d02ed0645a8ba2" title="Pausing the smartie sorter and operated manually.">SYS_MODE_PAUSE</a>)
<a name="l00152"></a>00152         <span class="keywordflow">return</span>;
<a name="l00153"></a>00153     ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#d5b7e91c9a338f631520d1bad5912c8e" title="Stores the last mode for transition steps.">mode_last</a> = ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#903c7b848a8b43a1b50e2fbb54a7cb7d" title="Stores the current mode.">mode</a>;
<a name="l00154"></a>00154     ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#903c7b848a8b43a1b50e2fbb54a7cb7d" title="Stores the current mode.">mode</a> = <a class="code" href="system_8h.html#6e4cea4b6246f491c526211f5405627df1c8a041b6d3d46002d02ed0645a8ba2" title="Pausing the smartie sorter and operated manually.">SYS_MODE_PAUSE</a>;
<a name="l00155"></a>00155 }
<a name="l00156"></a>00156 
<a name="l00163"></a><a class="code" href="system_8h.html#6d65cab872ca8f9d37af4287ee012740">00163</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#6d65cab872ca8f9d37af4287ee012740" title="Initiates color callibration for corresponding smartie color.">sys_reference_measure_blue</a> () {
<a name="l00164"></a>00164     ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> = <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc55e7156e0e78e0f3ce9f2ce0d7bbe8bac5" title="Calibrates the color refence values. Halts the state machine.">prog_set_colors_blue</a>;
<a name="l00165"></a>00165 }
<a name="l00166"></a>00166 
<a name="l00170"></a><a class="code" href="system_8h.html#4ff06646314a1ccaf1947c9986c2486d">00170</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#4ff06646314a1ccaf1947c9986c2486d" title="See sys_reference_measure_blue ().">sys_reference_measure_green</a>() {
<a name="l00171"></a>00171     ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> = <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc55d6ae9a7c1b1f295ef5d5b24ce2b82ee9" title="Calibrates the color refence values. Halts the state machine.">prog_set_colors_green</a>;
<a name="l00172"></a>00172 }
<a name="l00173"></a>00173 
<a name="l00177"></a><a class="code" href="system_8h.html#1ca664e0f0800b98f4e3cbb6295429ee">00177</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#1ca664e0f0800b98f4e3cbb6295429ee" title="See sys_reference_measure_blue ().">sys_reference_measure_red</a>() {
<a name="l00178"></a>00178     ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> = <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc5520d6445008330db524343a7f811b3e5b" title="Calibrates the color refence values. Halts the state machine.">prog_set_colors_red</a>;
<a name="l00179"></a>00179 }
<a name="l00180"></a>00180 
<a name="l00184"></a><a class="code" href="system_8h.html#4dfe8d9daa9b136d3c7b5eb0c7d54489">00184</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#4dfe8d9daa9b136d3c7b5eb0c7d54489" title="See sys_reference_measure_blue ().">sys_reference_measure_yellow</a>() {
<a name="l00185"></a>00185     ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> = <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc55cacbcee890d85b9ebe3b797cc57516f3" title="Calibrates the color refence values. Halts the state machine.">prog_set_colors_yellow</a>;   
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 
<a name="l00191"></a><a class="code" href="system_8h.html#430fcc5c084c5d195784456a4b0241fe">00191</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#430fcc5c084c5d195784456a4b0241fe" title="See sys_reference_measure_blue ().">sys_reference_measure_orange</a>() {
<a name="l00192"></a>00192     ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> = <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc553e3770483237eb4ea1076e81dc517d30" title="Calibrates the color refence values. Halts the state machine.">prog_set_colors_orange</a>;
<a name="l00193"></a>00193 }
<a name="l00194"></a>00194 
<a name="l00198"></a><a class="code" href="system_8h.html#5ede569de5e4adae83654eadf689319d">00198</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#5ede569de5e4adae83654eadf689319d" title="See sys_reference_measure_blue ().">sys_reference_measure_brown</a>() {
<a name="l00199"></a>00199     ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> = <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc559e40df4de71d78cd961b87202f71645c" title="Calibrates the color refence values. Halts the state machine.">prog_set_colors_brown</a>;
<a name="l00200"></a>00200 }
<a name="l00201"></a>00201 
<a name="l00205"></a><a class="code" href="system_8h.html#ae77d91f8801da390b9dec1e4a740d85">00205</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#ae77d91f8801da390b9dec1e4a740d85" title="See sys_reference_measure_blue ().">sys_reference_measure_purple</a>() {
<a name="l00206"></a>00206     ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> = <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc553a7a5a24627fdea73087ba56c941b3ab" title="Calibrates the color refence values. Halts the state machine.">prog_set_colors_purple</a>;
<a name="l00207"></a>00207 }
<a name="l00208"></a>00208 
<a name="l00212"></a><a class="code" href="system_8h.html#30d1084c81b5ad36c00bb9ee8fe9ac13">00212</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#30d1084c81b5ad36c00bb9ee8fe9ac13" title="See sys_reference_measure_blue ().">sys_reference_measure_pink</a>() {
<a name="l00213"></a>00213     ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> = <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc5501a7745145aaf9b3fe840b3cb1a6b84f" title="Calibrates the color refence values. Halts the state machine.">prog_set_colors_pink</a>;
<a name="l00214"></a>00214 }
<a name="l00215"></a>00215 
<a name="l00222"></a><a class="code" href="system_8h.html#10b0d9845d6c021370b0d06a5a876205">00222</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#10b0d9845d6c021370b0d06a5a876205" title="Initiates to restore the color reference values.">sys_reference_measure_restore</a>() {
<a name="l00223"></a>00223     ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> = <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc5532962d0000a87aa56300fc78330ac987" title="Resores the color refernce values to system defaults. Halts the state machine.">prog_set_colors_restore</a>;
<a name="l00224"></a>00224 }
<a name="l00225"></a>00225 
<a name="l00233"></a><a class="code" href="system_8h.html#73eeab714172d1723e3d412f36002a9b">00233</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#73eeab714172d1723e3d412f36002a9b" title="Leave the pause mode.">sys_resume</a>()
<a name="l00234"></a>00234 {
<a name="l00235"></a>00235     <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#903c7b848a8b43a1b50e2fbb54a7cb7d" title="Stores the current mode.">mode</a> == <a class="code" href="system_8h.html#6e4cea4b6246f491c526211f5405627d564529220e61e848983d8eb9d7f87736" title="Smartie sorter is running automatically.">SYS_MODE_RUNNING</a>)
<a name="l00236"></a>00236         <span class="keywordflow">return</span>;
<a name="l00237"></a>00237     ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#d5b7e91c9a338f631520d1bad5912c8e" title="Stores the last mode for transition steps.">mode_last</a> = ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#903c7b848a8b43a1b50e2fbb54a7cb7d" title="Stores the current mode.">mode</a>;
<a name="l00238"></a>00238     ss.<a class="code" href="structsmartie__sorter__t.html#e1f5a066e6d2b665e740e2e85abda282" title="Stores the current state.">state</a>.<a class="code" href="structsystem__state__t.html#903c7b848a8b43a1b50e2fbb54a7cb7d" title="Stores the current mode.">mode</a> = <a class="code" href="system_8h.html#6e4cea4b6246f491c526211f5405627d564529220e61e848983d8eb9d7f87736" title="Smartie sorter is running automatically.">SYS_MODE_RUNNING</a>;
<a name="l00239"></a>00239 }
<a name="l00240"></a>00240 
<a name="l00244"></a><a class="code" href="system_8h.html#5ac3b5cf6f06e3ff4d3c745f9d5c693a">00244</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#5ac3b5cf6f06e3ff4d3c745f9d5c693a" title="Set the operating speed of the sorter to the current demand value.">sys_set_speed</a> () {
<a name="l00245"></a>00245     ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#8d1622d7b7bfa1be48ceeaa0c1691e26" title="Default value (CATCH_PAUSE_DURATION or REV_PAUSE_DURATION).">pause_duration</a> = ss.<a class="code" href="structsmartie__sorter__t.html#dd43953759e4028e7eae83127ce6c98b" title="The operating speed (pause durations) the higher, the slower. See also sys_set_speed()...">speed</a>;
<a name="l00246"></a>00246     ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#8d1622d7b7bfa1be48ceeaa0c1691e26" title="Default value (CATCH_PAUSE_DURATION or REV_PAUSE_DURATION).">pause_duration</a> = ss.<a class="code" href="structsmartie__sorter__t.html#dd43953759e4028e7eae83127ce6c98b" title="The operating speed (pause durations) the higher, the slower. See also sys_set_speed()...">speed</a>;
<a name="l00247"></a>00247     ss.<a class="code" href="structsmartie__sorter__t.html#aa730d2f15b0f5bc4292378612577a4a" title="Shaker (or vibrator).">vibr</a>.<a class="code" href="structvibrator__t.html#3fc18b753af884b44c24013e0ffff2b1" title="How long to vibrate the shaker in ms ( SHAKER_DURATION ).">duration</a> = ss.<a class="code" href="structsmartie__sorter__t.html#dd43953759e4028e7eae83127ce6c98b" title="The operating speed (pause durations) the higher, the slower. See also sys_set_speed()...">speed</a> + (ss.<a class="code" href="structsmartie__sorter__t.html#dd43953759e4028e7eae83127ce6c98b" title="The operating speed (pause durations) the higher, the slower. See also sys_set_speed()...">speed</a> &gt;&gt; 1); <span class="comment">/* Set to 1.5 of ss.speed (binary division by two) */</span>
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249 
<a name="l00256"></a><a class="code" href="system_8h.html#1826940cb85dc745f43b80c8554b3047">00256</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#1826940cb85dc745f43b80c8554b3047" title="Set the operating speed of the sorter up by decreasing pause times.">sys_speed_up</a> () {
<a name="l00257"></a>00257     ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> = prog_set_speed;
<a name="l00258"></a>00258     <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#dd43953759e4028e7eae83127ce6c98b" title="The operating speed (pause durations) the higher, the slower. See also sys_set_speed()...">speed</a> &lt; 5000)
<a name="l00259"></a>00259         ss.<a class="code" href="structsmartie__sorter__t.html#dd43953759e4028e7eae83127ce6c98b" title="The operating speed (pause durations) the higher, the slower. See also sys_set_speed()...">speed</a> += 100;
<a name="l00260"></a>00260     <a class="code" href="system_8c.html#5ac3b5cf6f06e3ff4d3c745f9d5c693a" title="Set the operating speed of the sorter to the current demand value.">sys_set_speed</a> ();
<a name="l00261"></a>00261 }
<a name="l00262"></a>00262 
<a name="l00269"></a><a class="code" href="system_8h.html#86167f37ad40f4c37766d17c9d07845d">00269</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#86167f37ad40f4c37766d17c9d07845d" title="Set the operating speed of the sorter down by increasing pause times.">sys_speed_down</a> () {
<a name="l00270"></a>00270     ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> = prog_set_speed;
<a name="l00271"></a>00271     <span class="keywordflow">if</span> (ss.<a class="code" href="structsmartie__sorter__t.html#dd43953759e4028e7eae83127ce6c98b" title="The operating speed (pause durations) the higher, the slower. See also sys_set_speed()...">speed</a> &gt; 100)
<a name="l00272"></a>00272         ss.<a class="code" href="structsmartie__sorter__t.html#dd43953759e4028e7eae83127ce6c98b" title="The operating speed (pause durations) the higher, the slower. See also sys_set_speed()...">speed</a> -= 100;
<a name="l00273"></a>00273     <a class="code" href="system_8c.html#5ac3b5cf6f06e3ff4d3c745f9d5c693a" title="Set the operating speed of the sorter to the current demand value.">sys_set_speed</a>();
<a name="l00274"></a>00274 }
<a name="l00275"></a>00275 
<a name="l00279"></a><a class="code" href="system_8h.html#4fdb3cc2b07ea1f4534bc1c3ac60a865">00279</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#4fdb3cc2b07ea1f4534bc1c3ac60a865" title="Initiate a color measurement with the tcs color sensor.">sys_measure_tcs</a> () {
<a name="l00280"></a>00280     ss.<a class="code" href="structsmartie__sorter__t.html#e79de6c1d37bb79d82dff4a2490b7c40" title="The programm which is running during SYS_MODE_PAUSE.">prog</a> = <a class="code" href="system_8h.html#6cfd37e27dfa4a49be0ab6d983f4fc5527897518563ff6607106d839ed48fd8e" title="Indicates that the color measure program is runnging.">prog_color_tcs</a>;
<a name="l00281"></a>00281     ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#6cf7d985b536f4551302359ddb90c802" title="The current status of the color sensor.">status</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b0338a176a30f108279905bb42b5f80ad22" title="Setting a module&amp;#39;s state to this will start the device to work.">stat_start_working</a>;
<a name="l00282"></a>00282 }
<a name="l00283"></a>00283 
<a name="l00287"></a><a class="code" href="system_8h.html#0f47aa3043bc1362fbe37d003acfaf4e">00287</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#0f47aa3043bc1362fbe37d003acfaf4e" title="Initiate a color measurement with the adjd color sensor.">sys_measure_adjd</a> () {
<a name="l00288"></a>00288 }
<a name="l00289"></a>00289 
<a name="l00290"></a>00290 <span class="preprocessor">#if 0</span>
<a name="l00291"></a>00291 <span class="preprocessor"></span>
<a name="l00292"></a>00292 <span class="comment">//TODO: deprecated</span>
<a name="l00301"></a>00301 <span class="comment"></span><span class="keywordtype">void</span> sys_wait(uint16_t time) {
<a name="l00302"></a>00302     <span class="keywordtype">float</span> f_cycles;
<a name="l00303"></a>00303     uint16_t u_cycles;
<a name="l00304"></a>00304 
<a name="l00305"></a>00305     f_cycles = 0.000001 / F_CPU;
<a name="l00306"></a>00306 
<a name="l00307"></a>00307     f_cycles += 0.5;
<a name="l00308"></a>00308     u_cycles = f_cycles; <span class="comment">// round and convert</span>
<a name="l00309"></a>00309 
<a name="l00310"></a>00310     <span class="keywordflow">do</span> {
<a name="l00311"></a>00311         <span class="keywordflow">do</span> {
<a name="l00312"></a>00312             <span class="keyword">asm</span> <span class="keyword">volatile</span> (<span class="stringliteral">"nop"</span>);
<a name="l00313"></a>00313         }<span class="keywordflow">while</span> (u_cycles--);
<a name="l00314"></a>00314     } <span class="keywordflow">while</span> (time--);
<a name="l00315"></a>00315 }
<a name="l00316"></a>00316 <span class="preprocessor">#endif</span>
<a name="l00317"></a>00317 <span class="preprocessor"></span>
<a name="l00318"></a>00318 
<a name="l00322"></a><a class="code" href="system_8h.html#ef389e924ee5fb5cb82da6c6a11209b5">00322</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#ef389e924ee5fb5cb82da6c6a11209b5" title="Initiates the vibrator to start.">vibrator_start</a>() {
<a name="l00323"></a>00323     ss.<a class="code" href="structsmartie__sorter__t.html#aa730d2f15b0f5bc4292378612577a4a" title="Shaker (or vibrator).">vibr</a>.<a class="code" href="structvibrator__t.html#adaff41fc66c7912a53deda23fb63836" title="Status.">status</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b0338a176a30f108279905bb42b5f80ad22" title="Setting a module&amp;#39;s state to this will start the device to work.">stat_start_working</a>;
<a name="l00324"></a>00324 }
<a name="l00325"></a>00325 
<a name="l00329"></a><a class="code" href="system_8h.html#b2694695c165d073dd47850b83904682">00329</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#b2694695c165d073dd47850b83904682" title="Initiates the color detection by the ADJD color sensor.">sensor_adjd_get_color</a>() {
<a name="l00330"></a>00330     ss.<a class="code" href="structsmartie__sorter__t.html#59076ebbfebca17e84e199762ac2e22d" title="Digital color sensor.">sens_adjd</a>.<a class="code" href="structcolor__sensor__adjd__t.html#9a68510ce77ed9824408724a06982a9c" title="The current status of the color sensor.">status</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b0338a176a30f108279905bb42b5f80ad22" title="Setting a module&amp;#39;s state to this will start the device to work.">stat_start_working</a>;
<a name="l00331"></a>00331 }
<a name="l00332"></a>00332 
<a name="l00336"></a><a class="code" href="system_8h.html#895d4e598ce146273eb5dc50e5a140ea">00336</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#895d4e598ce146273eb5dc50e5a140ea" title="Initiates the color detection by the TCS color sensor.">sensor_tcs_get_color</a>() {
<a name="l00337"></a>00337     ss.<a class="code" href="structsmartie__sorter__t.html#754376ba2843632710265283f54c1322" title="Analog color sensor.">sens_tcs</a>.<a class="code" href="structcolor__sensor__tcs__t.html#6cf7d985b536f4551302359ddb90c802" title="The current status of the color sensor.">status</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b0338a176a30f108279905bb42b5f80ad22" title="Setting a module&amp;#39;s state to this will start the device to work.">stat_start_working</a>;
<a name="l00338"></a>00338 }
<a name="l00339"></a>00339 
<a name="l00346"></a><a class="code" href="system_8h.html#97b11d5bfac2abcab58401879440e202">00346</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#97b11d5bfac2abcab58401879440e202" title="Rotates the catcher to a certain position.">catcher_rotate_absolute</a>(smartie_color move_to) {
<a name="l00347"></a>00347     int8_t move_rel = 0;
<a name="l00348"></a>00348     
<a name="l00349"></a>00349     <span class="keywordflow">if</span> (move_to == ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>) {
<a name="l00350"></a>00350         <span class="comment">/* just indicate we have done something */</span>
<a name="l00351"></a>00351         ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b036c9c8c7b8f55418d3c0981b2412f9324" title="Indicates the device is finished. The device will automatically change to this state...">stat_finished</a>;
<a name="l00352"></a>00352         <span class="keywordflow">return</span>;
<a name="l00353"></a>00353     }
<a name="l00354"></a>00354 <span class="preprocessor">#if 0   </span><span class="comment">/* now catcher which can handle unrecognized colors */</span>
<a name="l00355"></a>00355     <span class="keywordflow">if</span> (move_to == <a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b2eded117679751933625c43b5c80d7a44" title="Indexed as last color (highest counter). Insert colors above this one!">col_unknown</a>) { <span class="comment">/* Treat as empty */</span>
<a name="l00356"></a>00356         <span class="comment">/* Pretend we have done something */</span>
<a name="l00357"></a>00357         ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b036c9c8c7b8f55418d3c0981b2412f9324" title="Indicates the device is finished. The device will automatically change to this state...">stat_finished</a>;
<a name="l00358"></a>00358         <span class="keywordflow">return</span>;
<a name="l00359"></a>00359     }
<a name="l00360"></a>00360 <span class="preprocessor">#endif</span>
<a name="l00361"></a>00361 <span class="preprocessor"></span>    
<a name="l00362"></a>00362     <span class="keywordflow">if</span> (move_to &gt; ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>)
<a name="l00363"></a>00363         move_rel = move_to - ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>;
<a name="l00364"></a>00364     <span class="keywordflow">if</span> (move_to &lt;= ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a>)
<a name="l00365"></a>00365         move_rel = <a class="code" href="system_8h.html#ebeee5d587e924ad6d94000c311f24af" title="The amount of catcher tubes for sorting the smarties.">CATCH_MAX_SIZE</a> - ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a> + move_to;
<a name="l00366"></a>00366     
<a name="l00367"></a>00367     <a class="code" href="system_8c.html#2c5ecc52ef42cf3086da340a8e3eae13" title="Rotates the catcher from the current position to a relative next position regarding...">catcher_rotate_relative</a>(move_rel);
<a name="l00368"></a>00368 }
<a name="l00369"></a>00369 
<a name="l00384"></a><a class="code" href="system_8h.html#d039241a59aee99e3d08cdd722aa4a21">00384</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#2c5ecc52ef42cf3086da340a8e3eae13" title="Rotates the catcher from the current position to a relative next position regarding...">catcher_rotate_relative</a>(int8_t rel_pos) {
<a name="l00385"></a>00385     <span class="keywordflow">if</span> (rel_pos == 0) {
<a name="l00386"></a>00386         <span class="comment">/* Pretend we have done something */</span>
<a name="l00387"></a>00387         ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b036c9c8c7b8f55418d3c0981b2412f9324" title="Indicates the device is finished. The device will automatically change to this state...">stat_finished</a>;
<a name="l00388"></a>00388         <span class="keywordflow">return</span>;
<a name="l00389"></a>00389     }
<a name="l00390"></a>00390     
<a name="l00391"></a>00391     <span class="keywordflow">if</span> ( (ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a> + rel_pos) &gt;= <a class="code" href="system_8h.html#ebeee5d587e924ad6d94000c311f24af" title="The amount of catcher tubes for sorting the smarties.">CATCH_MAX_SIZE</a> ) 
<a name="l00392"></a>00392         ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#a21f2e88216c74bd38d655b596b927c2" title="Target position (smartie_color_t can also be used).">target_pos</a> = ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a> - <a class="code" href="system_8h.html#ebeee5d587e924ad6d94000c311f24af" title="The amount of catcher tubes for sorting the smarties.">CATCH_MAX_SIZE</a> + rel_pos;
<a name="l00393"></a>00393     <span class="keywordflow">else</span> 
<a name="l00394"></a>00394         ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#a21f2e88216c74bd38d655b596b927c2" title="Target position (smartie_color_t can also be used).">target_pos</a> = ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a> + rel_pos;
<a name="l00395"></a>00395     
<a name="l00396"></a>00396     <span class="comment">//ss.mot_catcher.lb-&gt;passes = 0;</span>
<a name="l00397"></a>00397     
<a name="l00398"></a>00398     ss.<a class="code" href="structsmartie__sorter__t.html#b5ef065f7badb65086f95596429da8a0" title="Stepper motor for the catcher area.">mot_catcher</a>.<a class="code" href="structstepper__motor__t.html#71c0bbc3adc7f7f200e6853fd361c12d" title="Status.">status</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b0338a176a30f108279905bb42b5f80ad22" title="Setting a module&amp;#39;s state to this will start the device to work.">stat_start_working</a>;
<a name="l00399"></a>00399 }
<a name="l00400"></a>00400 
<a name="l00415"></a><a class="code" href="system_8h.html#4312b8582a99de2443c53adce9359dc5">00415</a> <span class="keywordtype">void</span> <a class="code" href="system_8c.html#4312b8582a99de2443c53adce9359dc5" title="Rotates the revolver from the current position to a relative next position regarding...">revolver_rotate_relative</a>(int8_t rel_pos) {
<a name="l00416"></a>00416     <span class="keywordflow">if</span> (rel_pos == 0) {
<a name="l00417"></a>00417         <span class="comment">/* Pretend we have done something */</span>
<a name="l00418"></a>00418         ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#4bbf149941b37969ce2a486bc7bea81e" title="The last status.">status_last</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b036c9c8c7b8f55418d3c0981b2412f9324" title="Indicates the device is finished. The device will automatically change to this state...">stat_finished</a>;
<a name="l00419"></a>00419         <span class="keywordflow">return</span>;
<a name="l00420"></a>00420     }
<a name="l00421"></a>00421     
<a name="l00422"></a>00422     <span class="keywordflow">if</span> ( (ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a> + rel_pos) &gt;= <a class="code" href="system_8h.html#388331d885423f07d4a701af481c62a7" title="The amount of smarties (holes) which fit into the revolver.">REV_MAX_SIZE</a> ) 
<a name="l00423"></a>00423         ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#a21f2e88216c74bd38d655b596b927c2" title="Target position (smartie_color_t can also be used).">target_pos</a> = ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a> - <a class="code" href="system_8h.html#388331d885423f07d4a701af481c62a7" title="The amount of smarties (holes) which fit into the revolver.">REV_MAX_SIZE</a> + rel_pos;
<a name="l00424"></a>00424     <span class="keywordflow">else</span> 
<a name="l00425"></a>00425         ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#a21f2e88216c74bd38d655b596b927c2" title="Target position (smartie_color_t can also be used).">target_pos</a> = ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#00163b2a2a26dd96e68beb08f4eb3c6e" title="Current position (smartie_color_t can also be used).">current_pos</a> + rel_pos;
<a name="l00426"></a>00426     
<a name="l00427"></a>00427     ss.<a class="code" href="structsmartie__sorter__t.html#5b8f8fbb8530900a08b4dcdfad2408fa" title="Stepper motor for the revolver.">mot_revolver</a>.<a class="code" href="structstepper__motor__t.html#71c0bbc3adc7f7f200e6853fd361c12d" title="Status.">status</a> = <a class="code" href="system_8h.html#6bfb87db0720ecda67ba06ab52162b0338a176a30f108279905bb42b5f80ad22" title="Setting a module&amp;#39;s state to this will start the device to work.">stat_start_working</a>;
<a name="l00428"></a>00428 }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 <span class="preprocessor">#if 0 </span><span class="comment">/* deprecated ? */</span>
<a name="l00431"></a>00431 <span class="comment">//TODO: docs</span>
<a name="l00432"></a>00432 smartie_color make_color_merge(smartie_color color1, smartie_color color2) {
<a name="l00433"></a>00433     <span class="keywordflow">return</span> 0; 
<a name="l00434"></a>00434 }
<a name="l00435"></a>00435 <span class="preprocessor">#endif</span>
<a name="l00436"></a>00436 <span class="preprocessor"></span>
<a name="l00437"></a>00437 <span class="preprocessor">#if TABLE_REFERENCE_DETECTION</span>
<a name="l00438"></a>00438 <span class="preprocessor"></span>
<a name="l00471"></a>00471 uint8_t col_tab_blu [<a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b2eded117679751933625c43b5c80d7a44" title="Indexed as last color (highest counter). Insert colors above this one!">col_unknown</a>][2] = {
<a name="l00472"></a>00472         <span class="comment">/* {blue_lo_limit, blue_hi_limit} */</span>
<a name="l00473"></a>00473         {29,33}, 
<a name="l00474"></a>00474         { 6, 9}, 
<a name="l00475"></a>00475         { 5, 7}, 
<a name="l00476"></a>00476         { 9,11}, 
<a name="l00477"></a>00477         { 5, 8}, 
<a name="l00478"></a>00478         { 4, 8}, 
<a name="l00479"></a>00479         { 7,12}, 
<a name="l00480"></a>00480         {12,15} 
<a name="l00481"></a>00481 };
<a name="l00482"></a>00482 
<a name="l00486"></a>00486 uint8_t col_tab_gre [<a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b2eded117679751933625c43b5c80d7a44" title="Indexed as last color (highest counter). Insert colors above this one!">col_unknown</a>][2] = {
<a name="l00487"></a>00487         <span class="comment">/* {green_lo_limit, green_hi_limit} */</span>
<a name="l00488"></a>00488         {24,28}, <span class="comment">// Index \ref col_blue</span>
<a name="l00489"></a>00489         {20,23}, <span class="comment">// Index \ref col_green</span>
<a name="l00490"></a>00490         { 9,11}, <span class="comment">// Index \ref col_red</span>
<a name="l00491"></a>00491         {32,35}, <span class="comment">// Index \ref col_yellow</span>
<a name="l00492"></a>00492         {12,17}, <span class="comment">// Index \ref col_orange</span>
<a name="l00493"></a>00493         { 6,10}, <span class="comment">// Index \ref col_brown</span>
<a name="l00494"></a>00494         { 8,15}, <span class="comment">// Index \ref col_purple</span>
<a name="l00495"></a>00495         {12,17} <span class="comment">// Index \ref col_pink</span>
<a name="l00496"></a>00496 };
<a name="l00497"></a>00497 
<a name="l00501"></a>00501 uint8_t col_tab_red [<a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b2eded117679751933625c43b5c80d7a44" title="Indexed as last color (highest counter). Insert colors above this one!">col_unknown</a>][2] = {
<a name="l00502"></a>00502         <span class="comment">// {red_lo_limit, red_hi_limit}</span>
<a name="l00503"></a>00503         {30,34}, <span class="comment">// Index \ref col_blue</span>
<a name="l00504"></a>00504         {19,23}, <span class="comment">// Index \ref col_green</span>
<a name="l00505"></a>00505         {43,50}, <span class="comment">// Index \ref col_red</span>
<a name="l00506"></a>00506         {37,45}, <span class="comment">// Index \ref col_yellow</span>
<a name="l00507"></a>00507         {41,49}, <span class="comment">// Index \ref col_orange</span>
<a name="l00508"></a>00508         {17,22}, <span class="comment">// Index \ref col_brown</span>
<a name="l00509"></a>00509         {19,31}, <span class="comment">// Index \ref col_purple</span>
<a name="l00510"></a>00510         {41,47} <span class="comment">// Index \ref col_pink</span>
<a name="l00511"></a>00511 };
<a name="l00512"></a>00512 
<a name="l00513"></a>00513 uint8_t col_tab_non [<a class="code" href="system_8h.html#7b19b2744b17f8f369226dd73101a4b2eded117679751933625c43b5c80d7a44" title="Indexed as last color (highest counter). Insert colors above this one!">col_unknown</a>][2] = {
<a name="l00514"></a>00514         {10,96}, <span class="comment">// Index \ref col_blue</span>
<a name="l00515"></a>00515         {54,55}, <span class="comment">// Index \ref col_green</span>
<a name="l00516"></a>00516         {56,67}, <span class="comment">// Index \ref col_red</span>
<a name="l00517"></a>00517         {10,98}, <span class="comment">// Index \ref col_yellow</span>
<a name="l00518"></a>00518         {64,80}, <span class="comment">// Index \ref col_orange</span>
<a name="l00519"></a>00519         {31,44}, <span class="comment">// Index \ref col_brown</span>
<a name="l00520"></a>00520         {46,51}, <span class="comment">// Index \ref col_purple</span>
<a name="l00521"></a>00521         {73,81} <span class="comment">// Index \ref col_pink      </span>
<a name="l00522"></a>00522 };
<a name="l00523"></a>00523 <span class="preprocessor">#endif </span>
<a name="l00524"></a>00524 <span class="preprocessor"></span>
<a name="l00525"></a>00525 <span class="preprocessor">#if DISTANCE_DETECTION | DISTANCE_NORM_DETECTION</span>
<a name="l00526"></a>00526 <span class="preprocessor"></span>
<a name="l00527"></a>00527 <a class="code" href="system_8h.html#b51ee7141ec54f3e8185d9487af887d5" title="Stores the color reference values of one channel for all smarties.">color_avarage</a> col_ava_blu;
<a name="l00528"></a>00528 <a class="code" href="system_8h.html#b51ee7141ec54f3e8185d9487af887d5" title="Stores the color reference values of one channel for all smarties.">color_avarage</a> col_ava_gre;
<a name="l00529"></a>00529 <a class="code" href="system_8h.html#b51ee7141ec54f3e8185d9487af887d5" title="Stores the color reference values of one channel for all smarties.">color_avarage</a> col_ava_red;
<a name="l00530"></a>00530 
<a name="l00531"></a>00531 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Aug 29 13:48:09 2008 for Smarties2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
